import{r as e,l as p}from"./chunk-K6CSEXPM--6-6YwCy.js";const E=e.createContext({user:null,token:null,isAuthenticated:!1,login:()=>{},logout:()=>{}}),v=({children:u})=>{const[i,a]=e.useState(null),[s,n]=e.useState(null),[g,l]=e.useState(!1),[f,h]=e.useState(!0),[r,d]=e.useState(!1);e.useEffect(()=>{d(!0),h(!1)},[]),e.useEffect(()=>{if(r)try{const t=localStorage.getItem("auth_token"),o=localStorage.getItem("user_data");if(t&&o){const c=JSON.parse(o);a(c),n(t),l(!0)}}catch(t){console.error("Error parsing stored user data:",t),r&&(localStorage.removeItem("auth_token"),localStorage.removeItem("user_data"))}},[r]);const m=(t,o)=>{if(a(t),n(o),l(!0),r)try{localStorage.setItem("auth_token",o),localStorage.setItem("user_data",JSON.stringify(t))}catch(c){console.error("Error saving auth data:",c)}},S=async()=>{try{if(r&&s)try{await fetch("https://eventqr.app/api/auth/logout/",{method:"POST",headers:{Authorization:`Token ${s}`,"Content-Type":"application/json"}})}catch(t){console.error("Error calling logout API:",t)}}catch(t){console.error("Error during logout:",t)}finally{if(a(null),n(null),l(!1),r)try{localStorage.removeItem("auth_token"),localStorage.removeItem("user_data")}catch(t){console.error("Error clearing local storage:",t)}}};return f?null:p.jsx(E.Provider,{value:{user:i,token:s,isAuthenticated:g,login:m,logout:S},children:u})};export{E as A,v as a};
