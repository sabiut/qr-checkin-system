import{w as C,a as A}from"./with-props-W20A4A-s.js";import{r as o,l as e,n as T,L as a,M as _,o as z,S as L,p as P,O as M,q as J}from"./chunk-K6CSEXPM--6-6YwCy.js";import{A as $,a as B}from"./AuthContext-ChgrtSKK.js";import{Q as R}from"./qr-code-1vz7lEYt.js";import{U as N}from"./user-CNUf_l29.js";import{S,L as k}from"./settings-zJGg6SF2.js";import{X as q}from"./x-DjrKpXYw.js";import{c as U}from"./createLucideIcon-DiAdES6P.js";const F={getAuthToken(){return typeof window>"u"||!window.localStorage?null:localStorage.getItem("auth_token")},async syncAll(){try{return typeof navigator<"u"&&!navigator.onLine?{success:!1,message:"Cannot sync while offline. Please try again when you're connected to the internet."}:typeof window>"u"||!window.localStorage?{success:!1,message:"Synchronization is not available in this environment."}:(await this.syncEvents(),await this.syncInvitations(),await this.syncCheckIns(),{success:!0,message:"All data synchronized successfully!"})}catch(n){return console.error("Sync error:",n),{success:!1,message:`Synchronization failed: ${n instanceof Error?n.message:String(n)}`}}},async syncEvents(){if(typeof window>"u"||!window.localStorage)return;const n=JSON.parse(localStorage.getItem("pending_events")||"[]");if(n.length!==0)try{const t=this.getAuthToken();if(!t)throw new Error("Authentication required to sync events");const i=await fetch("https://eventqr.app/api/events/sync/",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Token ${t}`},body:JSON.stringify(n)});if(!i.ok)throw new Error("Failed to sync events");const s=(await i.json()).id_mapping||{},c=JSON.parse(localStorage.getItem("events")||"[]").map(l=>s[l.id]?{...l,id:s[l.id]}:l);localStorage.setItem("events",JSON.stringify(c)),localStorage.removeItem("pending_events")}catch(t){throw console.error("Event sync error:",t),t}},async syncInvitations(){if(typeof window>"u"||!window.localStorage)return;const n=JSON.parse(localStorage.getItem("pending_invitations")||"[]");if(n.length!==0)try{const t=this.getAuthToken();if(!t)throw new Error("Authentication required to sync invitations");const i=await fetch("https://eventqr.app/api/invitations/sync/",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Token ${t}`},body:JSON.stringify(n)});if(!i.ok)throw new Error("Failed to sync invitations");const s=(await i.json()).id_mapping||{},d=[...new Set(n.map(c=>c.event_id))];for(const c of d){const l=`invitations_${c}`,p=JSON.parse(localStorage.getItem(l)||"[]").map(m=>s[m.id]?{...m,id:s[m.id]}:m);localStorage.setItem(l,JSON.stringify(p))}localStorage.removeItem("pending_invitations")}catch(t){throw console.error("Invitation sync error:",t),t}},async syncCheckIns(){if(typeof window>"u"||!window.localStorage)return;const n=JSON.parse(localStorage.getItem("offline_checkins")||"[]");if(n.length!==0)try{const t=this.getAuthToken();if(!t)throw new Error("Authentication required to sync check-ins");if(!(await fetch("https://eventqr.app/api/attendance/sync-offline/",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Token ${t}`},body:JSON.stringify({invitation_ids:n})})).ok)throw new Error("Failed to sync check-ins");localStorage.removeItem("offline_checkins")}catch(t){throw console.error("Check-in sync error:",t),t}}},Q=()=>{const[n,t]=o.useState(!1),[i,r]=o.useState(0),[s,d]=o.useState(0),[c,l]=o.useState(0),[f,p]=o.useState(!1),[m,x]=o.useState(null),[g,y]=o.useState(!1);o.useEffect(()=>{y(!0),typeof navigator<"u"&&t(!navigator.onLine)},[]),o.useEffect(()=>{if(!g)return;const h=()=>t(!1),j=()=>t(!0);window.addEventListener("online",h),window.addEventListener("offline",j);const b=()=>{try{if(typeof window>"u"||!window.localStorage)return;const w=JSON.parse(localStorage.getItem("pending_events")||"[]");r(w.length);const I=JSON.parse(localStorage.getItem("pending_invitations")||"[]");d(I.length);const O=JSON.parse(localStorage.getItem("offline_checkins")||"[]");l(O.length)}catch(w){console.error("Error counting pending items:",w)}};b();const E=setInterval(b,5e3);return()=>{window.removeEventListener("online",h),window.removeEventListener("offline",j),clearInterval(E)}},[g]);const v=async()=>{if(!g||n){x({text:"Cannot sync while offline. Please try again when you're connected to the internet.",type:"error"});return}p(!0),x(null);try{const h=await F.syncAll();x({text:h.message,type:h.success?"success":"error"}),r(0),d(0),l(0)}catch(h){x({text:`Sync failed: ${h instanceof Error?h.message:String(h)}`,type:"error"})}finally{p(!1)}},u=i+s+c;return!g||u===0&&!n?null:e.jsx("div",{className:"fixed bottom-4 right-4 z-50",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-lg p-4 max-w-xs w-full",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h3",{className:"font-medium text-gray-800",children:n?"Offline Mode":"Sync Status"}),e.jsx("div",{className:`w-3 h-3 rounded-full ${n?"bg-red-500":"bg-green-500"}`})]}),u>0&&e.jsxs("div",{className:"mb-3 text-sm text-gray-600",children:[e.jsx("p",{children:"Pending changes to sync:"}),e.jsxs("ul",{className:"ml-4 mt-1 list-disc",children:[i>0&&e.jsxs("li",{children:[i," event",i!==1?"s":""]}),s>0&&e.jsxs("li",{children:[s," invitation",s!==1?"s":""]}),c>0&&e.jsxs("li",{children:[c," check-in",c!==1?"s":""]})]})]}),m&&e.jsx("div",{className:`text-sm p-2 mb-3 rounded ${m.type==="success"?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:m.text}),e.jsx("button",{onClick:v,disabled:n||f||u===0,className:`w-full py-2 px-4 rounded text-white text-sm ${n||u===0?"bg-gray-400 cursor-not-allowed":"bg-blue-600 hover:bg-blue-700"}`,children:f?"Syncing...":"Sync Now"})]})})};/**
 * @license lucide-react v0.482.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const H=[["line",{x1:"4",x2:"20",y1:"12",y2:"12",key:"1e0a9i"}],["line",{x1:"4",x2:"20",y1:"6",y2:"6",key:"1owob3"}],["line",{x1:"4",x2:"20",y1:"18",y2:"18",key:"yk5zj1"}]],Y=U("Menu",H);function X(){var x,g,y,v;const[n,t]=o.useState(!1),[i,r]=o.useState(!1),{user:s,isAuthenticated:d,logout:c}=o.useContext($),l=T(),[f,p]=o.useState(!1);o.useEffect(()=>{p(!0)},[]),o.useEffect(()=>{if(!f)return;const u=h=>{i&&!h.target.closest("#user-menu")&&r(!1)};return document.addEventListener("click",u),()=>document.removeEventListener("click",u)},[i,f]);const m=async()=>{await c(),l("/login")};return e.jsxs("nav",{className:"bg-indigo-600",children:[e.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:e.jsxs("div",{className:"flex items-center justify-between h-16",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsxs(a,{to:"/",className:"flex items-center",children:[e.jsx(R,{className:"h-8 w-8 text-white"}),e.jsx("span",{className:"ml-2 text-white font-bold text-lg",children:"QR Check-in"})]})}),e.jsx("div",{className:"hidden md:block",children:e.jsxs("div",{className:"ml-10 flex items-baseline space-x-4",children:[e.jsx(a,{to:"/",className:"text-white hover:bg-indigo-500 hover:bg-opacity-75 px-3 py-2 rounded-md text-sm font-medium",children:"Home"}),d&&e.jsx(a,{to:"/events",className:"text-white hover:bg-indigo-500 hover:bg-opacity-75 px-3 py-2 rounded-md text-sm font-medium",children:"Events"})]})})]}),e.jsx("div",{className:"hidden md:block",children:e.jsx("div",{className:"ml-4 flex items-center md:ml-6",children:d?e.jsxs("div",{className:"relative ml-3",id:"user-menu",children:[e.jsx("div",{children:e.jsxs("button",{onClick:()=>r(!i),className:"max-w-xs bg-indigo-700 rounded-full flex items-center text-sm focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-indigo-600 focus:ring-white",children:[e.jsx("span",{className:"sr-only",children:"Open user menu"}),e.jsx("div",{className:"h-8 w-8 rounded-full bg-indigo-800 flex items-center justify-center text-white",children:((x=s==null?void 0:s.first_name)==null?void 0:x[0])||((g=s==null?void 0:s.username)==null?void 0:g[0])||"U"})]})}),i&&e.jsxs("div",{className:"origin-top-right absolute right-0 mt-2 w-48 rounded-md shadow-lg py-1 bg-white ring-1 ring-black ring-opacity-5 z-10",children:[e.jsxs("div",{className:"px-4 py-2 border-b",children:[e.jsx("p",{className:"text-sm font-medium text-gray-700",children:s==null?void 0:s.username}),e.jsx("p",{className:"text-xs text-gray-500 truncate",children:s==null?void 0:s.email})]}),e.jsxs(a,{to:"/profile",className:"block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 flex items-center",children:[e.jsx(N,{size:16,className:"mr-2"}),"Your Profile"]}),e.jsxs(a,{to:"/settings",className:"block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 flex items-center",children:[e.jsx(S,{size:16,className:"mr-2"}),"Settings"]}),e.jsxs("button",{onClick:m,className:"w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 flex items-center",children:[e.jsx(k,{size:16,className:"mr-2"}),"Sign out"]})]})]}):e.jsxs("div",{className:"flex gap-3",children:[e.jsx(a,{to:"/login",className:"text-white bg-indigo-500 hover:bg-indigo-400 px-3 py-2 rounded-md text-sm font-medium",children:"Sign in"}),e.jsx(a,{to:"/register",className:"text-indigo-100 hover:bg-indigo-500 hover:text-white px-3 py-2 rounded-md text-sm font-medium",children:"Register"})]})})}),e.jsxs("div",{className:"md:hidden flex items-center",children:[d&&e.jsxs("div",{className:"flex-shrink-0 relative mr-2",id:"user-menu",children:[e.jsx("button",{onClick:()=>r(!i),className:"bg-indigo-700 p-1 rounded-full text-indigo-200 hover:text-white focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-indigo-600 focus:ring-white",children:e.jsx("div",{className:"h-8 w-8 rounded-full bg-indigo-800 flex items-center justify-center text-white",children:((y=s==null?void 0:s.first_name)==null?void 0:y[0])||((v=s==null?void 0:s.username)==null?void 0:v[0])||"U"})}),i&&e.jsxs("div",{className:"origin-top-right absolute right-0 mt-2 w-48 rounded-md shadow-lg py-1 bg-white ring-1 ring-black ring-opacity-5 z-10",children:[e.jsxs("div",{className:"px-4 py-2 border-b",children:[e.jsx("p",{className:"text-sm font-medium text-gray-700",children:s==null?void 0:s.username}),e.jsx("p",{className:"text-xs text-gray-500 truncate",children:s==null?void 0:s.email})]}),e.jsxs(a,{to:"/profile",className:"block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 flex items-center",children:[e.jsx(N,{size:16,className:"mr-2"}),"Your Profile"]}),e.jsxs(a,{to:"/settings",className:"block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 flex items-center",children:[e.jsx(S,{size:16,className:"mr-2"}),"Settings"]}),e.jsxs("button",{onClick:m,className:"w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 flex items-center",children:[e.jsx(k,{size:16,className:"mr-2"}),"Sign out"]})]})]}),e.jsxs("button",{onClick:()=>t(!n),className:"bg-indigo-700 p-2 rounded-md inline-flex items-center justify-center text-indigo-200 hover:text-white hover:bg-indigo-500 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-indigo-600 focus:ring-white",children:[e.jsx("span",{className:"sr-only",children:"Open main menu"}),n?e.jsx(q,{className:"block h-6 w-6","aria-hidden":"true"}):e.jsx(Y,{className:"block h-6 w-6","aria-hidden":"true"})]})]})]})}),n&&e.jsx("div",{className:"md:hidden",children:e.jsxs("div",{className:"px-2 pt-2 pb-3 space-y-1 sm:px-3",children:[e.jsx(a,{to:"/",className:"text-white hover:bg-indigo-500 hover:bg-opacity-75 block px-3 py-2 rounded-md text-base font-medium",onClick:()=>t(!1),children:"Home"}),d&&e.jsx(a,{to:"/communication",className:"text-white hover:bg-indigo-500 hover:bg-opacity-75 block px-3 py-2 rounded-md text-base font-medium",onClick:()=>t(!1),children:"Communication"}),!d&&e.jsxs(e.Fragment,{children:[e.jsx(a,{to:"/login",className:"text-white hover:bg-indigo-500 hover:bg-opacity-75 block px-3 py-2 rounded-md text-base font-medium",onClick:()=>t(!1),children:"Sign in"}),e.jsx(a,{to:"/register",className:"text-white hover:bg-indigo-500 hover:bg-opacity-75 block px-3 py-2 rounded-md text-base font-medium",onClick:()=>t(!1),children:"Register"})]})]})})]})}const se=()=>[{rel:"preconnect",href:"https://fonts.googleapis.com"},{rel:"preconnect",href:"https://fonts.gstatic.com",crossOrigin:"anonymous"},{rel:"stylesheet",href:"https://fonts.googleapis.com/css2?family=Inter:ital,opsz,wght@0,14..32,100..900;1,14..32,100..900&display=swap"}];function ne({children:n}){return e.jsxs("html",{lang:"en",children:[e.jsxs("head",{children:[e.jsx("meta",{charSet:"utf-8"}),e.jsx("meta",{name:"viewport",content:"width=device-width, initial-scale=1"}),e.jsx(_,{}),e.jsx(z,{})]}),e.jsxs("body",{children:[n,e.jsx(L,{}),e.jsx(P,{})]})]})}const ie=C(function(){try{return typeof window<"u"?e.jsxs(B,{children:[e.jsx(X,{}),e.jsxs("main",{children:[e.jsx(M,{}),e.jsx(Q,{})]})]}):e.jsx("div",{className:"flex items-center justify-center bg-gray-50 py-4",children:e.jsxs("div",{className:"text-center",children:[e.jsx("h1",{className:"text-base font-semibold text-gray-800",children:"QR Check-in System"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Loading..."})]})})}catch(t){return console.error("Error in App component:",t),e.jsx("div",{className:"flex items-center justify-center bg-gray-50 py-4",children:e.jsxs("div",{className:"text-center",children:[e.jsx("h1",{className:"text-base font-semibold text-red-600",children:"Application Error"}),e.jsx("p",{className:"text-xs text-gray-600",children:"Error loading the application"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:t instanceof Error?t.message:String(t)}),e.jsx("button",{className:"mt-2 bg-blue-600 text-white px-2 py-1 text-xs rounded",onClick:()=>window.location.reload(),children:"Reload"})]})})}}),oe=A(function({error:t}){let i="Oops!",r="An unexpected error occurred.",s;return console.error("Error caught by ErrorBoundary:",t),J(t)?(i=t.status===404?"404":"Error",r=t.status===404?"The requested page could not be found.":t.statusText||r,console.error("Route error response:",{status:t.status,statusText:t.statusText})):t instanceof Error?(r=t.message,s=t.stack,console.error("Error instance:",{message:t.message,stack:t.stack})):console.error("Unknown error type:",t),e.jsxs("main",{className:"pt-16 p-4 container mx-auto",children:[e.jsx("h1",{className:"text-2xl font-bold mb-4",children:i}),e.jsx("p",{className:"mb-4",children:r}),s&&e.jsxs("div",{className:"bg-gray-100 p-4 rounded-lg mt-4",children:[e.jsx("h3",{className:"font-medium mb-2",children:"Stack Trace:"}),e.jsx("pre",{className:"w-full p-4 overflow-x-auto text-sm bg-gray-800 text-white rounded",children:e.jsx("code",{children:s})})]}),e.jsx("div",{className:"mt-6",children:e.jsx("a",{href:"/",className:"bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700",children:"Return to Home"})})]})});export{oe as ErrorBoundary,ne as Layout,ie as default,se as links};
