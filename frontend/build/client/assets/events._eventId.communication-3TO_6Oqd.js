import{w as as}from"./with-props-W20A4A-s.js";import{r as a,l as e,v as rs}from"./chunk-K6CSEXPM--6-6YwCy.js";import{A as ns}from"./AuthContext-ChgrtSKK.js";import{c as f}from"./createLucideIcon-DiAdES6P.js";import{H as re}from"./heart-DJvYK65H.js";import{C as ae}from"./clock-9uqc5bvb.js";import{X as Y}from"./x-DjrKpXYw.js";import{C as ne}from"./circle-check-big-TdVgapQe.js";import{U as we}from"./user-CNUf_l29.js";import{E as Fe,D as ls}from"./eye-B1-8Y-gW.js";import{S as Pe}from"./send-Wy_W9YVp.js";import{U as _e}from"./users-Q26tldAh.js";import{U as is}from"./user-check-DO35yh_q.js";import{M as Me}from"./mail-Dab9SNH2.js";import{C as Ee}from"./circle-alert-ieDbjemo.js";import{B as os}from"./bell-Czj4pWCS.js";import{M as $e}from"./message-circle-hbvmaL1M.js";import{P as cs}from"./ProtectedRoute-WFYVxz1c.js";/**
 * @license lucide-react v0.482.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ds=[["path",{d:"M22 12h-2.48a2 2 0 0 0-1.93 1.46l-2.35 8.36a.25.25 0 0 1-.48 0L9.24 2.18a.25.25 0 0 0-.48 0l-2.35 8.36A2 2 0 0 1 4.49 12H2",key:"169zse"}]],De=f("Activity",ds);/**
 * @license lucide-react v0.482.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xs=[["path",{d:"m15.477 12.89 1.515 8.526a.5.5 0 0 1-.81.47l-3.58-2.687a1 1 0 0 0-1.197 0l-3.586 2.686a.5.5 0 0 1-.81-.469l1.514-8.526",key:"1yiouv"}],["circle",{cx:"12",cy:"8",r:"6",key:"1vp47v"}]],Ue=f("Award",xs);/**
 * @license lucide-react v0.482.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ms=[["path",{d:"M3 3v16a2 2 0 0 0 2 2h16",key:"c24i48"}],["path",{d:"M18 17V9",key:"2bz60n"}],["path",{d:"M13 17V5",key:"1frdt8"}],["path",{d:"M8 17v-3",key:"17ska0"}]],us=f("ChartColumn",ms);/**
 * @license lucide-react v0.482.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const hs=[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]],ps=f("ChevronDown",hs);/**
 * @license lucide-react v0.482.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const gs=[["path",{d:"m18 15-6-6-6 6",key:"153udz"}]],Te=f("ChevronUp",gs);/**
 * @license lucide-react v0.482.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ys=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3",key:"1u773s"}],["path",{d:"M12 17h.01",key:"p32p05"}]],Oe=f("CircleHelp",ys);/**
 * @license lucide-react v0.482.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const bs=[["path",{d:"M11.562 3.266a.5.5 0 0 1 .876 0L15.39 8.87a1 1 0 0 0 1.516.294L21.183 5.5a.5.5 0 0 1 .798.519l-2.834 10.246a1 1 0 0 1-.956.734H5.81a1 1 0 0 1-.957-.734L2.02 6.02a.5.5 0 0 1 .798-.519l4.276 3.664a1 1 0 0 0 1.516-.294z",key:"1vdc57"}],["path",{d:"M5 21h14",key:"11awu3"}]],fs=f("Crown",bs);/**
 * @license lucide-react v0.482.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const js=[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"12",cy:"5",r:"1",key:"gxeob9"}],["circle",{cx:"12",cy:"19",r:"1",key:"lyex9k"}]],Ns=f("EllipsisVertical",js);/**
 * @license lucide-react v0.482.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const vs=[["line",{x1:"6",x2:"10",y1:"11",y2:"11",key:"1gktln"}],["line",{x1:"8",x2:"8",y1:"9",y2:"13",key:"qnk9ow"}],["line",{x1:"15",x2:"15.01",y1:"12",y2:"12",key:"krot7o"}],["line",{x1:"18",x2:"18.01",y1:"10",y2:"10",key:"1lcuu1"}],["path",{d:"M17.32 5H6.68a4 4 0 0 0-3.978 3.59c-.006.052-.01.101-.017.152C2.604 9.416 2 14.456 2 16a3 3 0 0 0 3 3c1 0 1.5-.5 2-1l1.414-1.414A2 2 0 0 1 9.828 16h4.344a2 2 0 0 1 1.414.586L17 18c.5.5 1 1 2 1a3 3 0 0 0 3-3c0-1.545-.604-6.584-.685-7.258-.007-.05-.011-.1-.017-.151A4 4 0 0 0 17.32 5z",key:"mfqc10"}]],ws=f("Gamepad2",vs);/**
 * @license lucide-react v0.482.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _s=[["rect",{x:"3",y:"8",width:"18",height:"4",rx:"1",key:"bkv52"}],["path",{d:"M12 8v13",key:"1c76mn"}],["path",{d:"M19 12v7a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2v-7",key:"6wjy6b"}],["path",{d:"M7.5 8a2.5 2.5 0 0 1 0-5A4.8 8 0 0 1 12 8a4.8 8 0 0 1 4.5-5 2.5 2.5 0 0 1 0 5",key:"1ihvrl"}]],Qe=f("Gift",_s);/**
 * @license lucide-react v0.482.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ks=[["path",{d:"M7.21 15 2.66 7.14a2 2 0 0 1 .13-2.2L4.4 2.8A2 2 0 0 1 6 2h12a2 2 0 0 1 1.6.8l1.6 2.14a2 2 0 0 1 .14 2.2L16.79 15",key:"143lza"}],["path",{d:"M11 12 5.12 2.2",key:"qhuxz6"}],["path",{d:"m13 12 5.88-9.8",key:"hbye0f"}],["path",{d:"M8 7h8",key:"i86dvs"}],["circle",{cx:"12",cy:"17",r:"5",key:"qbz8iq"}],["path",{d:"M12 18v-2h-.5",key:"fawc4q"}]],Cs=f("Medal",ks);/**
 * @license lucide-react v0.482.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ss=[["path",{d:"m3 11 18-5v12L3 14v-3z",key:"n962bs"}],["path",{d:"M11.6 16.8a3 3 0 1 1-5.8-1.6",key:"1yl0tm"}]],Be=f("Megaphone",Ss);/**
 * @license lucide-react v0.482.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const As=[["path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z",key:"1lielz"}]],ke=f("MessageSquare",As);/**
 * @license lucide-react v0.482.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $s=[["path",{d:"M12 17v5",key:"bb1du9"}],["path",{d:"M9 10.76a2 2 0 0 1-1.11 1.79l-1.78.9A2 2 0 0 0 5 15.24V16a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1v-.76a2 2 0 0 0-1.11-1.79l-1.78-.9A2 2 0 0 1 15 10.76V7a1 1 0 0 1 1-1 2 2 0 0 0 0-4H8a2 2 0 0 0 0 4 1 1 0 0 1 1 1z",key:"1nkz8b"}]],Ts=f("Pin",$s);/**
 * @license lucide-react v0.482.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ps=[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]],Z=f("Plus",Ps);/**
 * @license lucide-react v0.482.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ms=[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]],He=f("Search",Ms);/**
 * @license lucide-react v0.482.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ls=[["path",{d:"M11.525 2.295a.53.53 0 0 1 .95 0l2.31 4.679a2.123 2.123 0 0 0 1.595 1.16l5.166.756a.53.53 0 0 1 .294.904l-3.736 3.638a2.123 2.123 0 0 0-.611 1.878l.882 5.14a.53.53 0 0 1-.771.56l-4.618-2.428a2.122 2.122 0 0 0-1.973 0L6.396 21.01a.53.53 0 0 1-.77-.56l.881-5.139a2.122 2.122 0 0 0-.611-1.879L2.16 9.795a.53.53 0 0 1 .294-.906l5.165-.755a2.122 2.122 0 0 0 1.597-1.16z",key:"r04s7s"}]],Le=f("Star",Ls);/**
 * @license lucide-react v0.482.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Rs=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["circle",{cx:"12",cy:"12",r:"6",key:"1vlfrh"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}]],Ge=f("Target",Rs);/**
 * @license lucide-react v0.482.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const zs=[["polyline",{points:"22 7 13.5 15.5 8.5 10.5 2 17",key:"126l90"}],["polyline",{points:"16 7 22 7 22 13",key:"kwv8wd"}]],qs=f("TrendingUp",zs);/**
 * @license lucide-react v0.482.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Fs=[["path",{d:"M6 9H4.5a2.5 2.5 0 0 1 0-5H6",key:"17hqa7"}],["path",{d:"M18 9h1.5a2.5 2.5 0 0 0 0-5H18",key:"lmptdp"}],["path",{d:"M4 22h16",key:"57wxv0"}],["path",{d:"M10 14.66V17c0 .55-.47.98-.97 1.21C7.85 18.75 7 20.24 7 22",key:"1nw9bq"}],["path",{d:"M14 14.66V17c0 .55.47.98.97 1.21C16.15 18.75 17 20.24 17 22",key:"1np0yb"}],["path",{d:"M18 2H6v7a6 6 0 0 0 12 0V2Z",key:"u46fv3"}]],K=f("Trophy",Fs);/**
 * @license lucide-react v0.482.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Es=[["path",{d:"M4 14a1 1 0 0 1-.78-1.63l9.9-10.2a.5.5 0 0 1 .86.46l-1.92 6.02A1 1 0 0 0 13 10h7a1 1 0 0 1 .78 1.63l-9.9 10.2a.5.5 0 0 1-.86-.46l1.92-6.02A1 1 0 0 0 11 14z",key:"1xq2db"}]],Ie=f("Zap",Es),Ds=({eventId:u})=>{const[d,m]=a.useState([]),[g,B]=a.useState(null),[le,l]=a.useState(!0),[M,N]=a.useState("leaderboard"),[R,C]=a.useState(0),A="https://eventqr.app";a.useEffect(()=>{b(),L()},[u]);const b=async()=>{var o;try{console.log("Fetching leaderboard for event:",u);const _=localStorage.getItem("auth_token"),k=await fetch(`${A}/api/communication/icebreakers/leaderboard/?event_id=${u}`,{headers:{Authorization:`Token ${_}`,"Content-Type":"application/json"}});if(console.log("Leaderboard response status:",k.status),k.ok){const j=await k.json();console.log("Leaderboard data:",j),console.log("Leaderboard array:",j.leaderboard),console.log("Total participants:",j.total_participants),m(j.leaderboard||[]),C(j.total_participants||0),console.log("State set - leaderboard length:",(o=j.leaderboard)==null?void 0:o.length)}else{console.error("Leaderboard fetch failed:",k.status,k.statusText);const j=await k.text();console.error("Error response:",j)}}catch(_){console.error("Error fetching leaderboard:",_)}},L=async()=>{try{const o=localStorage.getItem("auth_token"),_=await fetch(`${A}/api/communication/icebreakers/user_stats/?event_id=${u}`,{headers:{Authorization:`Token ${o}`,"Content-Type":"application/json"}});if(_.ok){const k=await _.json();B(k)}}catch(o){console.error("Error fetching user stats:",o)}finally{l(!1)}},z=o=>{switch(o){case 1:return e.jsx(fs,{className:"w-6 h-6 text-yellow-500"});case 2:return e.jsx(Cs,{className:"w-6 h-6 text-gray-400"});case 3:return e.jsx(Ue,{className:"w-6 h-6 text-amber-600"});default:return e.jsx(K,{className:"w-5 h-5 text-gray-500"})}},X=o=>{switch(o){case 1:return"bg-gradient-to-r from-yellow-400 to-yellow-600 text-white";case 2:return"bg-gradient-to-r from-gray-300 to-gray-500 text-white";case 3:return"bg-gradient-to-r from-amber-400 to-amber-600 text-white";default:return"bg-gray-100 text-gray-700"}},ee=o=>o<60?`${Math.round(o)}s`:o<3600?`${Math.round(o/60)}m`:`${Math.round(o/3600)}h`;return le?e.jsx("div",{className:"bg-white rounded-lg shadow-md p-6",children:e.jsxs("div",{className:"animate-pulse",children:[e.jsx("div",{className:"h-4 bg-gray-200 rounded w-1/4 mb-4"}),e.jsx("div",{className:"space-y-3",children:[1,2,3,4,5].map(o=>e.jsx("div",{className:"h-12 bg-gray-200 rounded"},o))})]})}):e.jsxs("div",{className:"bg-white rounded-lg shadow-md overflow-hidden",children:[e.jsx("div",{className:"border-b border-gray-200",children:e.jsxs("div",{className:"flex",children:[e.jsxs("button",{onClick:()=>N("leaderboard"),className:`flex-1 px-4 py-3 text-sm font-medium ${M==="leaderboard"?"text-blue-600 border-b-2 border-blue-600 bg-blue-50":"text-gray-500 hover:text-gray-700"}`,children:[e.jsx(K,{className:"w-4 h-4 inline-block mr-2"}),"Leaderboard"]}),e.jsxs("button",{onClick:()=>N("mystats"),className:`flex-1 px-4 py-3 text-sm font-medium ${M==="mystats"?"text-blue-600 border-b-2 border-blue-600 bg-blue-50":"text-gray-500 hover:text-gray-700"}`,children:[e.jsx(Le,{className:"w-4 h-4 inline-block mr-2"}),"My Stats"]})]})}),e.jsx("div",{className:"p-6",children:M==="leaderboard"?e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"bg-gradient-to-r from-yellow-400 to-orange-500 p-3 rounded-full mr-2",children:e.jsx(K,{className:"w-6 h-6 text-white"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-2xl font-bold text-gray-900",children:"ðŸ† Icebreaker Champions"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Top performers in icebreaker activities"})]})]}),e.jsx("div",{className:"text-center",children:e.jsxs("div",{className:"bg-blue-100 text-blue-800 px-3 py-2 rounded-full",children:[e.jsx("div",{className:"text-lg font-bold",children:R}),e.jsx("div",{className:"text-xs",children:"participants"})]})})]}),d.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(K,{className:"w-12 h-12 text-gray-300 mx-auto mb-3"}),e.jsx("p",{className:"text-gray-500",children:"No participants yet"}),e.jsx("p",{className:"text-gray-400 text-sm",children:"Be the first to participate!"})]}):e.jsx("div",{className:"space-y-3",children:d.map(o=>e.jsxs("div",{className:"flex items-center py-4 border-b border-gray-100 last:border-b-0",children:[e.jsx("div",{className:"flex items-center mr-4",children:e.jsx("div",{className:`flex items-center justify-center w-8 h-8 rounded-full text-sm font-bold ${X(o.rank)}`,children:o.rank<=3?z(o.rank):o.rank})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"mb-2",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("p",{className:"text-xl font-bold text-gray-900",children:o.user.full_name||o.user.username}),o.rank<=3&&e.jsx("span",{className:"ml-2 text-sm text-yellow-600 font-medium",children:"ðŸ† Champion"})]}),e.jsxs("div",{className:"flex items-center mt-2 space-x-2",children:[o.current_streak>=3&&e.jsxs("div",{className:"flex items-center bg-gradient-to-r from-orange-100 to-yellow-100 text-orange-700 px-3 py-1 rounded-full border border-orange-200",children:[e.jsx(Ie,{className:"w-4 h-4"}),e.jsxs("span",{className:"text-xs font-bold ml-1",children:[o.current_streak," Day Streak!"]})]}),o.lucky_bonus_count>0&&e.jsxs("div",{className:"flex items-center bg-gradient-to-r from-purple-100 to-pink-100 text-purple-700 px-3 py-1 rounded-full border border-purple-200",children:[e.jsx(Qe,{className:"w-4 h-4"}),e.jsxs("span",{className:"text-xs font-bold ml-1",children:["Lucky x",o.lucky_bonus_count]})]})]})]}),e.jsxs("div",{className:"flex items-center space-x-6 text-sm text-gray-600",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(Ge,{className:"w-4 h-4 text-blue-600 mr-1.5"}),e.jsx("span",{className:"font-semibold text-gray-900",children:o.activities_completed}),e.jsx("span",{className:"ml-1",children:"activities"})]}),e.jsxs("div",{className:"text-xs text-gray-500 mt-0.5",children:["Base: ",o.base_points," | Bonus: ",o.bonus_points]}),e.jsxs("div",{className:"flex items-center mt-1",children:[e.jsx(re,{className:"w-4 h-4 text-red-600 mr-1.5"}),e.jsx("span",{className:"font-semibold text-gray-900",children:o.likes_received}),e.jsx("span",{className:"ml-1",children:"likes"})]})]}),o.average_response_time>0&&e.jsxs("div",{className:"flex items-center",children:[e.jsx(ae,{className:"w-4 h-4 text-green-600 mr-1.5"}),e.jsx("span",{className:"font-semibold text-gray-900",children:ee(o.average_response_time)}),e.jsx("span",{className:"ml-1",children:"avg"})]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-3xl font-bold text-gray-900",children:o.total_points.toLocaleString()}),e.jsx("div",{className:"text-sm text-gray-500",children:"points"})]})]},o.user.id))})]}):e.jsx("div",{children:e.jsxs("div",{className:"mb-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"Your Performance"}),g?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"bg-gradient-to-r from-blue-500 to-purple-600 rounded-lg p-6 text-white mb-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"text-3xl font-bold",children:["#",g.rank]}),e.jsx("div",{className:"text-blue-100",children:"Your Rank"})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-3xl font-bold",children:g.total_points.toLocaleString()}),e.jsx("div",{className:"text-blue-100",children:"Total Points"})]})]})}),e.jsxs("div",{className:"bg-white rounded-lg p-6 border border-gray-200 mb-6",children:[e.jsxs("div",{className:"grid grid-cols-3 gap-6",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"flex items-center justify-center w-12 h-12 bg-blue-100 rounded-full mx-auto mb-3",children:e.jsx(Ge,{className:"w-6 h-6 text-blue-600"})}),e.jsx("div",{className:"text-2xl font-bold text-gray-900",children:g.activities_completed}),e.jsx("div",{className:"text-sm text-gray-600 mb-2",children:"Activities"}),e.jsxs("div",{className:"text-xs text-gray-500",children:["Best streak: ",g.longest_streak]})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"flex items-center justify-center w-12 h-12 bg-green-100 rounded-full mx-auto mb-3",children:e.jsx(Ue,{className:"w-6 h-6 text-green-600"})}),e.jsx("div",{className:"text-2xl font-bold text-gray-900",children:g.total_points}),e.jsx("div",{className:"text-sm text-gray-600 mb-2",children:"Total Points"}),e.jsxs("div",{className:"text-xs text-gray-500",children:["Base: ",g.base_points," + Bonus: ",g.bonus_points]})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"flex items-center justify-center w-12 h-12 bg-red-100 rounded-full mx-auto mb-3",children:e.jsx(re,{className:"w-6 h-6 text-red-600"})}),e.jsx("div",{className:"text-2xl font-bold text-gray-900",children:g.likes_received}),e.jsx("div",{className:"text-sm text-gray-600 mb-2",children:"Likes Received"}),e.jsxs("div",{className:"text-xs text-gray-500",children:["Given: ",g.likes_given," | Lucky: ",g.lucky_bonus_count]})]})]}),e.jsx("div",{className:"mt-6 pt-4 border-t border-gray-100",children:e.jsxs("div",{className:"flex items-start justify-between text-sm",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("div",{className:"flex items-center mb-1",children:[e.jsx(Ie,{className:"w-4 h-4 text-orange-500 mr-2"}),e.jsx("span",{className:"text-gray-600",children:"Streak:"}),e.jsxs("span",{className:"ml-2 font-medium",children:[g.current_streak," days"]})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx(Qe,{className:"w-4 h-4 text-purple-500 mr-2"}),e.jsx("span",{className:"text-gray-600",children:"Lucky Pts:"}),e.jsxs("span",{className:"ml-2 font-medium text-purple-600",children:["+",g.total_lucky_points]})]})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("span",{className:"text-gray-600",children:"Multiplier:"}),e.jsxs("span",{className:"ml-2 font-medium text-orange-600",children:[g.streak_multiplier?g.streak_multiplier.toFixed(1):"1.0","x"]})]})]})})]}),e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[e.jsx("h4",{className:"font-medium text-gray-900 mb-3",children:"Point Breakdown"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Base Points:"}),e.jsx("span",{className:"font-medium",children:g.base_points})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Bonus Points:"}),e.jsxs("span",{className:"font-medium text-green-600",children:["+",g.bonus_points]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Streak Multiplier:"}),e.jsxs("span",{className:"font-medium text-orange-600",children:[g.streak_multiplier?g.streak_multiplier.toFixed(1):"1.0","x"]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Lucky Bonuses:"}),e.jsxs("span",{className:"font-medium text-purple-600",children:["+",g.total_lucky_points]})]})]})]})]}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx(qs,{className:"w-12 h-12 text-gray-300 mx-auto mb-3"}),e.jsx("p",{className:"text-gray-500",children:"No stats yet"}),e.jsx("p",{className:"text-gray-400 text-sm",children:"Participate in activities to see your stats!"})]})]})})})]})},Us=({eventId:u,token:d,showError:m,showSuccess:g})=>{const[B,le]=a.useState([]),[l,M]=a.useState(null),[N,R]=a.useState([]),[C,A]=a.useState({}),[b,L]=a.useState(!1),[z,X]=a.useState(!1),[ee,o]=a.useState(!1),[_,k]=a.useState("respond"),[j,H]=a.useState(null),[q,G]=a.useState(!1),[F,E]=a.useState(!1),[$,I]=a.useState("all"),[se,D]=a.useState(!1),[Ce,U]=a.useState(!1),[Se,ie]=a.useState([]),[W,oe]=a.useState("smart_pack"),[V,ce]=a.useState([]),[T,O]=a.useState(!1),[i,w]=a.useState({title:"",description:"",activity_type:"question",activity_data:{},is_featured:!1,points_reward:5}),P="https://eventqr.app",Q=async()=>{try{L(!0);let t=`${P}/api/communication/icebreakers/?event_id=${u}`;$==="featured"?t+="&featured=true":$==="upcoming"&&(t+="&upcoming=true");const n=await fetch(t,{headers:{Authorization:`Token ${d}`,"Content-Type":"application/json"}});if(n.ok){const c=await n.json();le(c.results||c)}}catch(t){console.error("Error fetching icebreaker activities:",t),m("Failed to load icebreaker activities")}finally{L(!1)}},ye=async t=>{try{console.log("Fetching responses for activity:",t);const n=await fetch(`${P}/api/communication/icebreaker-responses/?activity_id=${t}`,{headers:{Authorization:`Token ${d}`,"Content-Type":"application/json"}});if(console.log("Responses fetch status:",n.status),n.ok){const c=await n.json();console.log("Responses data:",c),console.log("Setting responses:",c.results||c),R(c.results||c)}else{console.error("Failed to fetch responses:",n.status,n.statusText);const c=await n.text();console.error("Error response:",c)}}catch(n){console.error("Error fetching responses:",n)}},be=async t=>{if(!C||Object.keys(C).length===0){m("Please provide a response");return}X(!0);try{const n=await fetch(`${P}/api/communication/icebreakers/${t}/respond/`,{method:"POST",headers:{Authorization:`Token ${d}`,"Content-Type":"application/json"},body:JSON.stringify({response_data:C,is_public:!0})});if(n.ok){const c=await n.json();A({}),o(!1),Q(),l&&ye(l.id),g(`Response submitted! You earned ${(l==null?void 0:l.points_reward)||0} points!`)}else{const c=await n.json();m(c.error||"Failed to submit response")}}catch(n){console.error("Error submitting response:",n),m("Network error: Could not submit response")}finally{X(!1)}},de=async()=>{var t,n;if(!i.title.trim()||!i.description.trim()){m("Please fill in title and description");return}E(!0);try{let c={};if(i.activity_type==="poll"){const p=((t=i.activity_data.options)==null?void 0:t.filter(y=>y.trim()))||[];if(p.length<2){m("Poll must have at least 2 options"),E(!1);return}c={question:i.activity_data.question||i.title,options:p}}else if(i.activity_type==="quiz"){const p=((n=i.activity_data.options)==null?void 0:n.filter(y=>y.trim()))||[];if(p.length<2||!i.activity_data.correct_answer){m("Quiz must have at least 2 options and a correct answer"),E(!1);return}c={question:i.activity_data.question||i.title,options:p,correct_answer:i.activity_data.correct_answer}}const x=await fetch(`${P}/api/communication/icebreakers/`,{method:"POST",headers:{Authorization:`Token ${d}`,"Content-Type":"application/json"},body:JSON.stringify({event:parseInt(u),title:i.title.trim(),description:i.description.trim(),activity_type:i.activity_type,activity_data:c,is_featured:i.is_featured,points_reward:i.points_reward,is_active:!0,allow_multiple_responses:!1,anonymous_responses:!1})});if(x.ok){const p=await x.json();G(!1),w({title:"",description:"",activity_type:"question",activity_data:{},is_featured:!1,points_reward:5}),Q(),g("Icebreaker activity created successfully!")}else{const p=await x.json();m(p.detail||p.error||"Failed to create activity")}}catch(c){console.error("Error creating activity:",c),m("Network error: Could not create activity")}finally{E(!1)}},fe=t=>{switch(t){case"poll":return e.jsx(De,{className:"w-5 h-5"});case"quiz":return e.jsx(K,{className:"w-5 h-5"});case"question":return e.jsx(ke,{className:"w-5 h-5"});case"challenge":return e.jsx(ws,{className:"w-5 h-5"});case"introduction":return e.jsx(_e,{className:"w-5 h-5"});default:return e.jsx(re,{className:"w-5 h-5"})}},xe=t=>{switch(t){case"poll":return"bg-blue-100 text-blue-700";case"quiz":return"bg-yellow-100 text-yellow-700";case"question":return"bg-green-100 text-green-700";case"challenge":return"bg-red-100 text-red-700";case"introduction":return"bg-purple-100 text-purple-700";default:return"bg-gray-100 text-gray-700"}},je=t=>{var n,c;switch(t.activity_type){case"poll":return e.jsxs("div",{className:"space-y-3",children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Choose your option:"}),(n=t.activity_data.options)==null?void 0:n.map((x,p)=>e.jsxs("label",{className:"flex items-center space-x-3 p-3 bg-gray-50 rounded-lg cursor-pointer hover:bg-gray-100",children:[e.jsx("input",{type:"radio",name:"poll_option",value:x,checked:C.selected_option===x,onChange:y=>A({selected_option:y.target.value}),className:"text-blue-600 focus:ring-blue-500"}),e.jsx("span",{className:"text-gray-900",children:x})]},p))]});case"quiz":return e.jsxs("div",{className:"space-y-4",children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Answer the question:"}),e.jsx("p",{className:"font-medium text-gray-900",children:t.activity_data.question}),(c=t.activity_data.options)==null?void 0:c.map((x,p)=>e.jsxs("label",{className:"flex items-center space-x-3 p-3 bg-gray-50 rounded-lg cursor-pointer hover:bg-gray-100",children:[e.jsx("input",{type:"radio",name:"quiz_answer",value:x,checked:C.selected_answer===x,onChange:y=>A({selected_answer:y.target.value}),className:"text-blue-600 focus:ring-blue-500"}),e.jsx("span",{className:"text-gray-900",children:x})]},p))]});default:return e.jsxs("div",{className:"space-y-3",children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Share your response:"}),e.jsx("textarea",{value:C.text_response||"",onChange:x=>A({text_response:x.target.value}),placeholder:"Write your response here...",className:"w-full px-4 py-3 bg-gray-50 border border-gray-200 rounded-xl text-gray-900 placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent resize-none",rows:4})]})}},me=async()=>{try{const t=await fetch(`${P}/api/communication/icebreakers/template_packs/`,{headers:{Authorization:`Token ${d}`,"Content-Type":"application/json"}});if(t.ok){const n=await t.json();ie(n)}}catch(t){console.error("Error fetching template packs:",t)}},Ne=async()=>{try{O(!0);const t=await fetch(`${P}/api/communication/icebreakers/generate/`,{method:"POST",headers:{Authorization:`Token ${d}`,"Content-Type":"application/json"},body:JSON.stringify({event_id:parseInt(u),pack_type:W,preview_only:!0})});if(t.ok){const n=await t.json();ce(n.activities),D(!1),U(!0)}else{const n=await t.json();m(n.error||"Failed to generate preview")}}catch(t){console.error("Error generating preview:",t),m("Network error: Could not generate preview")}finally{O(!1)}},J=async(t=!1)=>{try{O(!0);const n=await fetch(`${P}/api/communication/icebreakers/generate/`,{method:"POST",headers:{Authorization:`Token ${d}`,"Content-Type":"application/json"},body:JSON.stringify({event_id:parseInt(u),pack_type:W,auto_schedule:!0,auto_send:t})});if(n.ok){const c=await n.json();U(!1),Q(),g(`ðŸŽ‰ Created ${c.created} icebreaker activities! ${c.auto_sent?"The first one has been sent to all invitees.":""}`)}else{const c=await n.json();m(c.error||"Failed to generate activities")}}catch(n){console.error("Error generating activities:",n),m("Network error: Could not generate activities")}finally{O(!1)}};a.useEffect(()=>{d&&u&&(Q(),me())},[d,u,$]);const ue=t=>{const n=t.length,c=t.filter(y=>y.is_guest_response).length,x=n-c,p={};return t.forEach(y=>{if(y.response_data.selected_option){const he=y.response_data.selected_option;p[he]=(p[he]||0)+1}}),{totalResponses:n,guestResponses:c,registeredResponses:x,responseDistribution:p,responseRate:l?Math.round(n/Math.max(l.view_count,1)*100):0}},ve=()=>{if(!N.length||!l)return;const t=[["Name","Type","Email","Response","Date","Time"].join(","),...N.map(p=>[p.user_name,p.is_guest_response?"Guest":"Registered",p.guest_email||"",p.response_data.text||p.response_data.selected_option||"No response",new Date(p.created_at).toLocaleDateString(),new Date(p.created_at).toLocaleTimeString()].join(","))].join(`
`),n=new Blob([t],{type:"text/csv"}),c=URL.createObjectURL(n),x=document.createElement("a");x.href=c,x.download=`icebreaker_responses_${l.title.replace(/[^a-z0-9]/gi,"_").toLowerCase()}.csv`,document.body.appendChild(x),x.click(),document.body.removeChild(x),URL.revokeObjectURL(c)};return a.useEffect(()=>{l&&(ye(l.id),k("respond"))},[l]),a.useEffect(()=>{N.length>0&&H(ue(N))},[N]),e.jsxs("div",{className:"flex-1 overflow-y-auto bg-gradient-to-br from-gray-50 to-white",children:[e.jsxs("div",{className:"max-w-6xl mx-auto p-6",children:[e.jsxs("div",{className:"mb-6 flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Icebreaker Activities"}),e.jsx("p",{className:"text-gray-600 mt-1",children:"Connect with other attendees through fun activities"})]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsxs("button",{onClick:()=>D(!0),className:"flex items-center space-x-2 px-6 py-3 bg-gradient-to-r from-purple-500 via-pink-500 to-indigo-500 text-white rounded-xl font-semibold shadow-lg shadow-purple-500/25 hover:shadow-xl hover:scale-105 transition-all duration-200 relative overflow-hidden",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-purple-400 via-pink-400 to-indigo-400 opacity-0 hover:opacity-100 transition-opacity duration-200"}),e.jsx("span",{className:"text-xl relative z-10",children:"âœ¨"}),e.jsx("span",{className:"relative z-10",children:"Generate Fun Icebreakers"})]}),e.jsxs("button",{onClick:()=>G(!0),className:"flex items-center space-x-2 px-4 py-2.5 bg-gradient-to-r from-green-500 to-emerald-500 text-white rounded-xl font-medium shadow-lg shadow-green-500/25 hover:shadow-xl transition-all duration-200",children:[e.jsx(Z,{className:"w-4 h-4"}),e.jsx("span",{children:"Create Activity"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("button",{onClick:()=>I("all"),className:`px-4 py-2 rounded-lg font-medium transition-colors ${$==="all"?"bg-gradient-to-r from-blue-500 to-purple-500 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:"All"}),e.jsx("button",{onClick:()=>I("featured"),className:`px-4 py-2 rounded-lg font-medium transition-colors ${$==="featured"?"bg-gradient-to-r from-blue-500 to-purple-500 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:"Featured"}),e.jsx("button",{onClick:()=>I("upcoming"),className:`px-4 py-2 rounded-lg font-medium transition-colors ${$==="upcoming"?"bg-gradient-to-r from-blue-500 to-purple-500 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:"Upcoming"})]})]})]}),q&&e.jsxs("div",{className:"mb-6 bg-white rounded-2xl shadow-xl p-6 border border-gray-100",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Create New Icebreaker Activity"}),e.jsx("button",{onClick:()=>{G(!1),w({title:"",description:"",activity_type:"question",activity_data:{},is_featured:!1,points_reward:5})},className:"p-1 rounded-lg hover:bg-gray-100 text-gray-600",children:e.jsx(Y,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Activity Title"}),e.jsx("input",{type:"text",value:i.title,onChange:t=>w({...i,title:t.target.value}),placeholder:"e.g., Welcome Poll: What excites you most?",className:"w-full px-4 py-3 bg-gray-50 border border-gray-200 rounded-xl text-gray-900 placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Activity Type"}),e.jsxs("select",{value:i.activity_type,onChange:t=>w({...i,activity_type:t.target.value,activity_data:{}}),className:"w-full px-4 py-3 bg-gray-50 border border-gray-200 rounded-xl text-gray-900 focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-transparent",children:[e.jsx("option",{value:"question",children:"Open Question"}),e.jsx("option",{value:"poll",children:"Poll (Multiple Choice)"}),e.jsx("option",{value:"quiz",children:"Quiz (Right/Wrong Answer)"}),e.jsx("option",{value:"introduction",children:"Introduction"}),e.jsx("option",{value:"challenge",children:"Challenge"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Description"}),e.jsx("textarea",{value:i.description,onChange:t=>w({...i,description:t.target.value}),placeholder:"Describe what this activity is about and how attendees should participate...",className:"w-full px-4 py-3 bg-gray-50 border border-gray-200 rounded-xl text-gray-900 placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-transparent resize-none",rows:3})]}),(i.activity_type==="poll"||i.activity_type==="quiz")&&e.jsxs("div",{className:"space-y-3",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:i.activity_type==="poll"?"Poll Question (optional)":"Quiz Question"}),e.jsx("input",{type:"text",value:i.activity_data.question||"",onChange:t=>w({...i,activity_data:{...i.activity_data,question:t.target.value}}),placeholder:`Enter your ${i.activity_type} question...`,className:"w-full px-4 py-3 bg-gray-50 border border-gray-200 rounded-xl text-gray-900 placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-transparent"}),e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Options"}),(i.activity_data.options||["",""]).map((t,n)=>e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"text",value:t,onChange:c=>{const x=[...i.activity_data.options||["",""]];x[n]=c.target.value,w({...i,activity_data:{...i.activity_data,options:x}})},placeholder:`Option ${n+1}`,className:"flex-1 px-4 py-2 bg-gray-50 border border-gray-200 rounded-lg text-gray-900 placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-transparent"}),n>1&&e.jsx("button",{onClick:()=>{const c=[...i.activity_data.options||[]];c.splice(n,1),w({...i,activity_data:{...i.activity_data,options:c}})},className:"p-2 text-red-500 hover:bg-red-50 rounded-lg",children:e.jsx(Y,{className:"w-4 h-4"})})]},n)),e.jsxs("button",{onClick:()=>{const t=i.activity_data.options||["",""];w({...i,activity_data:{...i.activity_data,options:[...t,""]}})},className:"text-green-600 hover:text-green-700 text-sm font-medium flex items-center",children:[e.jsx(Z,{className:"w-4 h-4 mr-1"}),"Add Option"]}),i.activity_type==="quiz"&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Correct Answer"}),e.jsxs("select",{value:i.activity_data.correct_answer||"",onChange:t=>w({...i,activity_data:{...i.activity_data,correct_answer:t.target.value}}),className:"w-full px-4 py-3 bg-gray-50 border border-gray-200 rounded-xl text-gray-900 focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-transparent",children:[e.jsx("option",{value:"",children:"Select the correct answer"}),(i.activity_data.options||[]).map((t,n)=>t.trim()&&e.jsx("option",{value:t,children:t},n))]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Points Reward"}),e.jsx("input",{type:"number",min:"1",max:"100",value:i.points_reward,onChange:t=>w({...i,points_reward:parseInt(t.target.value)||5}),className:"w-full px-4 py-3 bg-gray-50 border border-gray-200 rounded-xl text-gray-900 focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-transparent"})]}),e.jsx("div",{className:"flex items-center",children:e.jsxs("label",{className:"flex items-center space-x-3",children:[e.jsx("input",{type:"checkbox",checked:i.is_featured,onChange:t=>w({...i,is_featured:t.target.checked}),className:"w-5 h-5 text-green-600 bg-gray-100 border-gray-300 rounded focus:ring-green-500"}),e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Featured Activity"}),e.jsx(Le,{className:"w-4 h-4 text-yellow-500"})]})})]}),e.jsxs("div",{className:"flex space-x-3 pt-4",children:[e.jsx("button",{onClick:de,disabled:F||!i.title.trim()||!i.description.trim(),className:"flex-1 py-3 bg-gradient-to-r from-green-500 to-emerald-500 text-white rounded-xl font-medium shadow-lg shadow-green-500/25 hover:shadow-xl transition-all duration-200 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center space-x-2",children:F?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-5 h-5 border-2 border-white border-t-transparent rounded-full animate-spin"}),e.jsx("span",{children:"Creating..."})]}):e.jsxs(e.Fragment,{children:[e.jsx(De,{className:"w-4 h-4"}),e.jsx("span",{children:"Create Activity"})]})}),e.jsx("button",{onClick:()=>{G(!1),w({title:"",description:"",activity_type:"question",activity_data:{},is_featured:!1,points_reward:5})},disabled:F,className:"px-6 py-3 bg-gray-100 text-gray-700 rounded-xl font-medium hover:bg-gray-200 transition-colors disabled:opacity-50",children:"Cancel"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsx("div",{className:"lg:col-span-2 space-y-4",children:b?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-6 h-6 border-2 border-blue-500 border-t-transparent rounded-full animate-spin"}),e.jsx("span",{className:"text-gray-600",children:"Loading activities..."})]})}):B.length===0?e.jsxs("div",{className:"bg-white rounded-2xl shadow-sm p-12 text-center",children:[e.jsx(re,{className:"w-16 h-16 text-gray-300 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-500",children:"No icebreaker activities yet"})]}):B.map(t=>e.jsx("div",{onClick:()=>M(t),className:`bg-white rounded-2xl shadow-sm hover:shadow-lg transition-all duration-200 cursor-pointer overflow-hidden ${(l==null?void 0:l.id)===t.id?"ring-2 ring-blue-500 ring-offset-2":""}`,children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[t.is_featured&&e.jsxs("span",{className:"inline-flex items-center px-3 py-1 bg-yellow-100 text-yellow-700 text-sm font-medium rounded-full",children:[e.jsx(Le,{className:"w-4 h-4 mr-1"}),"Featured"]}),e.jsxs("span",{className:`inline-flex items-center px-3 py-1 text-sm font-medium rounded-full ${xe(t.activity_type)}`,children:[fe(t.activity_type),e.jsx("span",{className:"ml-1",children:t.activity_type.charAt(0).toUpperCase()+t.activity_type.slice(1)})]}),t.has_responded&&e.jsxs("span",{className:"inline-flex items-center px-3 py-1 bg-green-100 text-green-700 text-sm font-medium rounded-full",children:[e.jsx(ne,{className:"w-4 h-4 mr-1"}),"Responded"]})]}),e.jsxs("span",{className:"text-sm text-gray-500 flex items-center",children:[e.jsx(ae,{className:"w-4 h-4 mr-1"}),t.time_ago]})]}),e.jsx("h3",{className:"text-xl font-semibold text-gray-900 mb-2",children:t.title}),e.jsx("p",{className:"text-gray-600 leading-relaxed mb-4",children:t.description}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-4 text-sm text-gray-500",children:[e.jsxs("span",{className:"flex items-center",children:[e.jsx(we,{className:"w-4 h-4 mr-1"}),t.creator.full_name||t.creator.username]}),e.jsxs("span",{className:"flex items-center",children:[e.jsx(ke,{className:"w-4 h-4 mr-1"}),t.response_count," responses"]}),e.jsxs("span",{className:"flex items-center",children:[e.jsx(Fe,{className:"w-4 h-4 mr-1"}),t.view_count," views"]})]}),e.jsxs("span",{className:"inline-flex items-center px-3 py-1 bg-orange-100 text-orange-700 text-sm font-medium rounded-full",children:[e.jsx(K,{className:"w-4 h-4 mr-1"}),t.points_reward," pts"]})]})]})},t.id))}),e.jsx("div",{className:"lg:col-span-1",children:l?e.jsxs("div",{className:"bg-white rounded-2xl shadow-sm p-6 sticky top-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Activity Details"}),e.jsx("button",{onClick:()=>M(null),className:"p-1 rounded-lg hover:bg-gray-100 text-gray-600",children:e.jsx(Y,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"space-y-4 mb-6",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-gray-900",children:l.title}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:l.description})]}),l.activity_type==="poll"&&l.activity_data.question&&e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-900 mb-2",children:"Poll Question:"}),e.jsx("p",{className:"text-sm text-gray-600",children:l.activity_data.question})]}),l.activity_type==="quiz"&&l.activity_data.question&&e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-900 mb-2",children:"Quiz Question:"}),e.jsx("p",{className:"text-sm text-gray-600",children:l.activity_data.question})]})]}),e.jsxs("div",{className:"flex mb-6",children:[e.jsxs("button",{onClick:()=>k("respond"),className:`flex-1 py-2 px-3 text-xs font-medium rounded-l-lg transition-colors ${_==="respond"?"bg-blue-500 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:[e.jsx(Pe,{className:"w-3 h-3 inline mr-1"}),"Respond"]}),e.jsxs("button",{onClick:()=>k("analytics"),className:`flex-1 py-2 px-3 text-xs font-medium transition-colors ${_==="analytics"?"bg-blue-500 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:[e.jsx(us,{className:"w-3 h-3 inline mr-1"}),"Analytics"]}),e.jsxs("button",{onClick:()=>k("leaderboard"),className:`flex-1 py-2 px-3 text-xs font-medium rounded-r-lg transition-colors ${_==="leaderboard"?"bg-blue-500 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:[e.jsx(K,{className:"w-3 h-3 inline mr-1"}),"Leaderboard"]})]}),_==="respond"?e.jsxs(e.Fragment,{children:[!l.has_responded||l.allow_multiple_responses?ee?e.jsxs("div",{className:"space-y-4",children:[je(l),e.jsxs("div",{className:"flex space-x-3",children:[e.jsx("button",{onClick:()=>be(l.id),disabled:z,className:"flex-1 py-3 bg-gradient-to-r from-blue-500 to-purple-500 text-white rounded-xl font-medium shadow-lg shadow-blue-500/25 hover:shadow-xl transition-all duration-200 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center space-x-2",children:z?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"}),e.jsx("span",{children:"Submitting..."})]}):e.jsxs(e.Fragment,{children:[e.jsx(Pe,{className:"w-4 h-4"}),e.jsx("span",{children:"Submit"})]})}),e.jsx("button",{onClick:()=>{o(!1),A({})},disabled:z,className:"px-4 py-3 bg-gray-100 text-gray-700 rounded-xl font-medium hover:bg-gray-200 transition-colors disabled:opacity-50",children:"Cancel"})]})]}):e.jsxs("button",{onClick:()=>o(!0),className:"w-full py-3 bg-gradient-to-r from-blue-500 to-purple-500 text-white rounded-xl font-medium shadow-lg shadow-blue-500/25 hover:shadow-xl transition-all duration-200 flex items-center justify-center space-x-2",children:[e.jsx(Z,{className:"w-4 h-4"}),e.jsx("span",{children:l.has_responded?"Respond Again":"Respond"})]}):e.jsxs("div",{className:"text-center p-4 bg-green-50 rounded-xl",children:[e.jsx(ne,{className:"w-8 h-8 text-green-600 mx-auto mb-2"}),e.jsx("p",{className:"text-sm text-green-700 font-medium",children:"You've already responded!"})]}),e.jsxs("div",{className:"mt-6",children:[e.jsxs("h4",{className:"font-medium text-gray-900 mb-4",children:["Recent Responses (",N.length,")"]}),e.jsx("div",{className:"space-y-3 max-h-64 overflow-y-auto",children:N.length===0?e.jsx("p",{className:"text-sm text-gray-500 text-center py-4",children:"No responses yet"}):N.slice(0,5).map(t=>e.jsxs("div",{className:"p-3 bg-gray-50 rounded-lg",children:[e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsx("span",{className:"text-sm font-medium text-gray-900",children:t.user_name}),e.jsx("span",{className:"text-xs text-gray-500",children:t.time_ago})]}),e.jsx("p",{className:"text-sm text-gray-600",children:t.response_data.text_response||t.response_data.selected_option||t.response_data.selected_answer||"Response shared"})]},t.id))})]})]}):_==="analytics"?e.jsx("div",{className:"space-y-6",children:j&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h4",{className:"font-medium text-gray-900",children:"Response Analytics"}),e.jsxs("button",{onClick:ve,className:"flex items-center space-x-1 px-3 py-1.5 text-sm bg-green-100 text-green-700 rounded-lg hover:bg-green-200 transition-colors",children:[e.jsx(ls,{className:"w-4 h-4"}),e.jsx("span",{children:"Export CSV"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx("div",{className:"bg-blue-50 p-4 rounded-lg",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(_e,{className:"w-5 h-5 text-blue-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-blue-900",children:"Total Responses"}),e.jsx("p",{className:"text-2xl font-bold text-blue-600",children:j.totalResponses})]})]})}),e.jsx("div",{className:"bg-green-50 p-4 rounded-lg",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Fe,{className:"w-5 h-5 text-green-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-green-900",children:"Response Rate"}),e.jsxs("p",{className:"text-2xl font-bold text-green-600",children:[j.responseRate,"%"]})]})]})})]}),e.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg",children:[e.jsx("h5",{className:"font-medium text-gray-900 mb-3",children:"User Type Breakdown"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(is,{className:"w-4 h-4 text-blue-600"}),e.jsx("span",{className:"text-sm text-gray-700",children:"Registered Users"})]}),e.jsx("span",{className:"text-sm font-medium text-gray-900",children:j.registeredResponses})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Me,{className:"w-4 h-4 text-green-600"}),e.jsx("span",{className:"text-sm text-gray-700",children:"Guests"})]}),e.jsx("span",{className:"text-sm font-medium text-gray-900",children:j.guestResponses})]})]})]}),Object.keys(j.responseDistribution).length>0&&e.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg",children:[e.jsx("h5",{className:"font-medium text-gray-900 mb-3",children:"Response Distribution"}),e.jsx("div",{className:"space-y-2",children:Object.entries(j.responseDistribution).map(([t,n])=>e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-gray-700",children:t}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-20 bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:"bg-blue-500 h-2 rounded-full",style:{width:`${n/j.totalResponses*100}%`}})}),e.jsx("span",{className:"text-sm font-medium text-gray-900 w-8",children:n})]})]},t))})]}),e.jsxs("div",{children:[e.jsxs("h5",{className:"font-medium text-gray-900 mb-3",children:["All Responses (",N.length,")"]}),e.jsx("div",{className:"space-y-3 max-h-64 overflow-y-auto",children:N.length===0?e.jsx("p",{className:"text-sm text-gray-500 text-center py-4",children:"No responses yet"}):N.map(t=>e.jsxs("div",{className:"p-3 bg-white border border-gray-200 rounded-lg",children:[e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{className:"text-sm font-medium text-gray-900",children:t.user_name}),e.jsx("span",{className:`px-2 py-0.5 rounded-full text-xs ${t.is_guest_response?"bg-green-100 text-green-700":"bg-blue-100 text-blue-700"}`,children:t.is_guest_response?"Guest":"User"})]}),e.jsx("span",{className:"text-xs text-gray-500",children:t.time_ago})]}),e.jsx("p",{className:"text-sm text-gray-600",children:t.response_data.text||t.response_data.selected_option||"Response shared"})]},t.id))})]})]})}):_==="leaderboard"?e.jsx("div",{className:"space-y-6",children:e.jsx(Ds,{eventId:u})}):null]}):e.jsxs("div",{className:"bg-white rounded-2xl shadow-sm p-12 text-center",children:[e.jsx(re,{className:"w-12 h-12 text-gray-300 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-500",children:"Select an activity to see details"})]})})]})]}),se&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl max-w-2xl w-full max-h-[80vh] overflow-y-auto",children:[e.jsx("div",{className:"p-6 border-b border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"text-2xl font-bold text-gray-900 flex items-center",children:[e.jsx("span",{className:"text-3xl mr-3",children:"âœ¨"}),"Generate Icebreakers"]}),e.jsx("p",{className:"text-gray-600 mt-1",children:"Choose a pack that fits your event perfectly"})]}),e.jsx("button",{onClick:()=>D(!1),className:"text-gray-400 hover:text-gray-600 transition-colors",children:e.jsx(Y,{className:"w-6 h-6"})})]})}),e.jsxs("div",{className:"p-6",children:[e.jsx("div",{className:"grid gap-4",children:Se.map(t=>e.jsx("div",{onClick:()=>oe(t.id),className:`p-6 border-2 rounded-xl cursor-pointer transition-all duration-200 ${W===t.id?"border-purple-500 bg-purple-50 shadow-lg":"border-gray-200 hover:border-purple-300 hover:bg-gray-50"}`,children:e.jsxs("div",{className:"flex items-start space-x-4",children:[e.jsx("div",{className:"text-3xl",children:t.icon}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"text-lg font-semibold text-gray-900",children:t.name}),e.jsx("p",{className:"text-gray-600 mt-1",children:t.description})]}),W===t.id&&e.jsx("div",{className:"text-purple-500",children:e.jsx(ne,{className:"w-6 h-6"})})]})},t.id))}),e.jsxs("div",{className:"flex justify-end space-x-3 mt-8 pt-6 border-t border-gray-200",children:[e.jsx("button",{onClick:()=>D(!1),className:"px-6 py-3 border border-gray-300 text-gray-700 rounded-xl font-medium hover:bg-gray-50 transition-colors",children:"Cancel"}),e.jsx("button",{onClick:Ne,disabled:T||!W,className:"px-8 py-3 bg-gradient-to-r from-purple-500 to-indigo-500 text-white rounded-xl font-semibold shadow-lg hover:shadow-xl disabled:opacity-50 transition-all duration-200 flex items-center space-x-2",children:T?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-white"}),e.jsx("span",{children:"Generating..."})]}):e.jsxs(e.Fragment,{children:[e.jsx("span",{children:"ðŸ‘€"}),e.jsx("span",{children:"Preview Activities"})]})})]})]})]})}),Ce&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl max-w-4xl w-full max-h-[80vh] overflow-y-auto",children:[e.jsx("div",{className:"p-6 border-b border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"text-2xl font-bold text-gray-900 flex items-center",children:[e.jsx("span",{className:"text-3xl mr-3",children:"ðŸŽ‰"}),"Ready to Create!"]}),e.jsxs("p",{className:"text-gray-600 mt-1",children:["We've prepared ",V.length," engaging icebreaker activities"]})]}),e.jsx("button",{onClick:()=>U(!1),className:"text-gray-400 hover:text-gray-600 transition-colors",children:e.jsx(Y,{className:"w-6 h-6"})})]})}),e.jsxs("div",{className:"p-6",children:[e.jsx("div",{className:"space-y-4 mb-8",children:V.map((t,n)=>e.jsxs("div",{className:"border border-gray-200 rounded-xl p-5 bg-gray-50",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsxs("span",{className:"text-2xl",children:[t.activity_type==="poll"&&"ðŸ—³ï¸",t.activity_type==="quiz"&&"ðŸ§ ",t.activity_type==="question"&&"ðŸ’­",t.activity_type==="introduction"&&"ðŸ‘‹",t.activity_type==="challenge"&&"ðŸŽ¯"]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-gray-900",children:t.title}),e.jsx("p",{className:"text-sm text-gray-600",children:t.description})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:"text-sm text-purple-600 font-medium",children:["ðŸ† ",t.points_reward," points"]}),t.starts_at&&e.jsxs("div",{className:"text-xs text-gray-500 mt-1",children:["Sends: ",new Date(t.starts_at).toLocaleDateString()]})]})]}),t.activity_data.question&&e.jsxs("div",{className:"mt-3 p-3 bg-white rounded-lg",children:[e.jsx("p",{className:"text-sm font-medium text-gray-700",children:t.activity_data.question}),t.activity_data.options&&e.jsx("div",{className:"mt-2 flex flex-wrap gap-2",children:t.activity_data.options.map((c,x)=>e.jsx("span",{className:"px-2 py-1 bg-gray-100 text-xs rounded-full text-gray-600",children:c},x))})]}),t.activity_data.prompt&&e.jsx("div",{className:"mt-3 p-3 bg-white rounded-lg",children:e.jsx("p",{className:"text-sm text-gray-700",children:t.activity_data.prompt})})]},n))}),e.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-xl p-4 mb-6",children:e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx("span",{className:"text-2xl",children:"ðŸš€"}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-blue-900",children:"Auto-Scheduling Included!"}),e.jsx("p",{className:"text-blue-700 text-sm mt-1",children:"These activities will be automatically scheduled leading up to your event. The first one can be sent immediately to get the engagement started!"})]})]})}),e.jsxs("div",{className:"flex justify-end space-x-3 pt-6 border-t border-gray-200",children:[e.jsx("button",{onClick:()=>U(!1),className:"px-6 py-3 border border-gray-300 text-gray-700 rounded-xl font-medium hover:bg-gray-50 transition-colors",children:"Back to Selection"}),e.jsx("button",{onClick:()=>J(!1),disabled:T,className:"px-6 py-3 bg-gray-600 text-white rounded-xl font-semibold hover:bg-gray-700 disabled:opacity-50 transition-colors",children:"Create Activities Only"}),e.jsx("button",{onClick:()=>J(!0),disabled:T,className:"px-8 py-3 bg-gradient-to-r from-green-500 to-emerald-500 text-white rounded-xl font-semibold shadow-lg hover:shadow-xl disabled:opacity-50 transition-all duration-200 flex items-center space-x-2",children:T?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-white"}),e.jsx("span",{children:"Creating..."})]}):e.jsxs(e.Fragment,{children:[e.jsx("span",{children:"ðŸ“§"}),e.jsx("span",{children:"Create & Send First One"})]})})]})]})]})})]})},Os=({eventId:u})=>{const{token:d}=a.useContext(ns);if(!d)return e.jsx("div",{className:"flex items-center justify-center h-screen bg-gradient-to-br from-gray-50 to-gray-100",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-xl p-8 max-w-md",children:[e.jsx(Ee,{className:"w-12 h-12 text-red-500 mx-auto mb-4"}),e.jsx("h2",{className:"text-xl font-semibold text-gray-900 text-center mb-2",children:"Authentication Required"}),e.jsx("p",{className:"text-gray-600 text-center",children:"Please log in to access the communication hub."})]})});const[m,g]=a.useState("messages"),[B,le]=a.useState([]),[l,M]=a.useState(null),[N,R]=a.useState([]),[C,A]=a.useState([]),[b,L]=a.useState({count:0,next:null,previous:null,currentPage:1,totalPages:1,isLoading:!1,isLoadingMore:!1}),[z,X]=a.useState([]),[ee,o]=a.useState([]),[_,k]=a.useState([]),[j,H]=a.useState(!1),[q,G]=a.useState(""),[F,E]=a.useState(""),[$,I]=a.useState(""),[se,D]=a.useState(""),[Ce,U]=a.useState(!1),[Se,ie]=a.useState(!1),[W,oe]=a.useState(!1),[V,ce]=a.useState(""),[T,O]=a.useState(""),[i,w]=a.useState("normal"),[P,Q]=a.useState("general"),[ye,be]=a.useState(!1),[de,fe]=a.useState(!1),[xe,je]=a.useState(!1),[me,Ne]=a.useState(!1),[J,ue]=a.useState(null),[ve,t]=a.useState(null),[n,c]=a.useState(""),x=a.useRef(null),p=a.useRef(null),y="https://eventqr.app",he=y.replace("http","ws"),We=[{id:"messages",label:"Messages",icon:$e},{id:"announcements",label:"Announcements",icon:Be},{id:"forum",label:"Forum",icon:_e},{id:"qa",label:"Q&A",icon:Oe},{id:"icebreakers",label:"Icebreakers",icon:re}],Ve=()=>{var s;(s=p.current)==null||s.scrollIntoView({behavior:"smooth"})};a.useEffect(()=>{Ve()},[N]);const pe=s=>{t(s),setTimeout(()=>t(null),3e3)},S=s=>{ue(s),setTimeout(()=>ue(null),5e3)},Je=async()=>{try{const s=await fetch(`${y}/api/communication/messages/conversations/?event_id=${u}`,{headers:{Authorization:`Token ${d}`,"Content-Type":"application/json"}});if(s.ok){const r=await s.json();le(r)}}catch(s){console.error("Error fetching conversations:",s)}},Ye=async s=>{try{be(!0);const r=await fetch(`${y}/api/communication/messages/with_user/?user_id=${s}&event_id=${u}`,{headers:{Authorization:`Token ${d}`,"Content-Type":"application/json"}});if(r.ok){const h=await r.json();R(h.results||h)}}catch(r){console.error("Error fetching messages:",r),S("Failed to load messages")}finally{be(!1)}},te=async(s=1,r=!1)=>{L(s===1?h=>({...h,isLoading:!0}):h=>({...h,isLoadingMore:!0}));try{const h=await fetch(`${y}/api/communication/announcements/?event_id=${u}&page=${s}`,{headers:{Authorization:`Token ${d}`,"Content-Type":"application/json"}});if(h.ok){const v=await h.json(),ge=v.results||v;r&&s>1?A(Ae=>[...Ae,...ge]):A(ge),L(Ae=>({...Ae,count:v.count||ge.length,next:v.next,previous:v.previous,currentPage:s,totalPages:v.count?Math.ceil(v.count/20):1,isLoading:!1,isLoadingMore:!1}))}}catch(h){console.error("Error fetching announcements:",h),L(v=>({...v,isLoading:!1,isLoadingMore:!1}))}},Re=async()=>{try{const s=await fetch(`${y}/api/communication/forum/threads/?event_id=${u}`,{headers:{Authorization:`Token ${d}`,"Content-Type":"application/json"}});if(s.ok){const r=await s.json();X(r.results||r)}}catch(s){console.error("Error fetching forum threads:",s)}},ze=async()=>{try{const s=await fetch(`${y}/api/communication/qa/questions/?event_id=${u}`,{headers:{Authorization:`Token ${d}`,"Content-Type":"application/json"}});if(s.ok){const r=await s.json();o(r.results||r)}}catch(s){console.error("Error fetching Q&A questions:",s)}},Ze=async()=>{try{const s=await fetch(`${y}/api/communication/messages/event_attendees/?event_id=${u}`,{headers:{Authorization:`Token ${d}`,"Content-Type":"application/json"}});if(s.ok){const r=await s.json();k(r)}}catch(s){console.error("Error fetching available users:",s)}},qe=async()=>{var s;if(!(!q.trim()||!l))try{const r={content:q.trim(),event:u};l.user.has_account&&l.user.id?r.recipient_id=l.user.id:r.recipient_email=l.user.email;const h=await fetch(`${y}/api/communication/messages/`,{method:"POST",headers:{Authorization:`Token ${d}`,"Content-Type":"application/json"},body:JSON.stringify(r)});if(h.ok){const v=await h.json();R(ge=>[v,...ge]),G(""),l.user.has_account||pe(`Message sent via email to ${l.user.full_name}`),l.user.has_account&&((s=x.current)==null?void 0:s.readyState)===WebSocket.OPEN&&x.current.send(JSON.stringify({type:"chat_message",message:q.trim(),recipient_id:l.user.id}))}else{const v=await h.json();S(v.detail||v.error||"Failed to send message")}}catch(r){console.error("Error sending message:",r),S("Failed to send message")}},Ke=async s=>{try{await fetch(`${y}/api/communication/announcements/${s}/mark_read/`,{method:"POST",headers:{Authorization:`Token ${d}`,"Content-Type":"application/json"}}),A(r=>r.map(h=>h.id===s?{...h,is_read:!0}:h))}catch(r){console.error("Error marking announcement as read:",r)}},Xe=async()=>{if(!V.trim()||!T.trim()){S("Please fill in both title and content");return}fe(!0);try{const s=await fetch(`${y}/api/communication/announcements/`,{method:"POST",headers:{Authorization:`Token ${d}`,"Content-Type":"application/json"},body:JSON.stringify({event:parseInt(u),title:V.trim(),content:T.trim(),priority:i,announcement_type:P})});if(s.ok)oe(!1),ce(""),O(""),w("normal"),Q("general"),te(),pe("Announcement posted successfully and emails sent to all invitees!");else{const r=await s.json();S(`Failed to create announcement: ${r.detail||"Unknown error"}`)}}catch(s){console.error("Error creating announcement:",s),S("Network error: Could not create announcement")}finally{fe(!1)}};a.useEffect(()=>{if(l&&d&&u){const s=`${he}/ws/chat/${u}/?token=${d}`;return x.current=new WebSocket(s),x.current.onopen=()=>{console.log("WebSocket connected")},x.current.onmessage=r=>{const h=JSON.parse(r.data);h.type==="chat_message"&&R(v=>[h.message,...v])},x.current.onerror=r=>{console.error("WebSocket error:",r)},()=>{var r;(r=x.current)==null||r.close()}}},[l,d,he,u]),a.useEffect(()=>{d&&u&&(m==="messages"?(Je(),Ze()):m==="announcements"?te():m==="forum"?Re():m==="qa"&&ze())},[d,m,u]),a.useEffect(()=>{l&&Ye(l.user.id)},[l]);const es=s=>{const r={user:{id:s.id,username:s.username,full_name:s.full_name||s.username,email:s.email,has_account:s.has_account},latest_message:null,unread_count:0};M(r),R([]),H(!1)},ss=s=>{switch(s){case"critical":return"bg-red-100 text-red-700 border-red-200";case"high":return"bg-orange-100 text-orange-700 border-orange-200";case"normal":return"bg-blue-100 text-blue-700 border-blue-200";case"low":return"bg-gray-100 text-gray-700 border-gray-200";default:return"bg-gray-100 text-gray-700 border-gray-200"}},ts=s=>{switch(s){case"critical":return"CRITICAL";case"high":return"HIGH";case"normal":return"INFO";case"low":return"LOW";default:return"DEFAULT"}};return e.jsxs("div",{className:"h-screen flex flex-col bg-gradient-to-br from-gray-50 via-white to-gray-50",children:[e.jsx("div",{className:"bg-white/80 backdrop-blur-lg shadow-sm border-b border-gray-200",children:e.jsxs("div",{className:"px-6 py-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent",children:"Communication Hub"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Stay connected with event participants"})]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsxs("button",{className:"relative p-2 rounded-lg hover:bg-gray-100 transition-colors",children:[e.jsx(os,{className:"w-5 h-5 text-gray-600"}),e.jsx("span",{className:"absolute top-1 right-1 w-2 h-2 bg-red-500 rounded-full"})]}),e.jsx("button",{className:"relative p-2 rounded-lg hover:bg-gray-100 transition-colors",children:e.jsx(He,{className:"w-5 h-5 text-gray-600"})})]})]}),e.jsx("div",{className:"flex space-x-2",children:We.map(s=>{const r=s.icon;return e.jsxs("button",{onClick:()=>g(s.id),className:`flex items-center space-x-2 px-4 py-2.5 rounded-lg font-medium transition-all duration-200 ${m===s.id?"bg-gradient-to-r from-blue-500 to-purple-500 text-white shadow-lg shadow-blue-500/25":"text-gray-600 hover:bg-gray-100"}`,children:[e.jsx(r,{className:"w-4 h-4"}),e.jsx("span",{children:s.label})]},s.id)})})]})}),e.jsxs("div",{className:"flex-1 flex overflow-hidden",children:[m==="messages"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"w-80 bg-white border-r border-gray-200 flex flex-col",children:[e.jsxs("div",{className:"p-4 border-b border-gray-100",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"Conversations"}),e.jsx("button",{onClick:()=>H(!j),className:"p-2 rounded-lg bg-blue-50 hover:bg-blue-100 text-blue-600 transition-colors",children:e.jsx(Z,{className:"w-4 h-4"})})]}),e.jsxs("div",{className:"relative",children:[e.jsx(He,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4"}),e.jsx("input",{type:"text",placeholder:"Search conversations...",value:n,onChange:s=>c(s.target.value),className:"w-full pl-10 pr-3 py-2 bg-gray-50 border border-gray-200 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]})]}),e.jsx("div",{className:"flex-1 overflow-y-auto",children:B.length===0?e.jsxs("div",{className:"p-4 text-center text-gray-500",children:[e.jsx($e,{className:"w-12 h-12 mx-auto mb-3 text-gray-300"}),e.jsx("p",{className:"text-sm",children:"No conversations yet"}),e.jsx("button",{onClick:()=>H(!0),className:"mt-3 text-blue-600 hover:text-blue-700 text-sm font-medium",children:"Start a conversation"})]}):e.jsx("div",{className:"divide-y divide-gray-100",children:B.filter(s=>{var r;return n===""||((r=s.user.full_name)==null?void 0:r.toLowerCase().includes(n.toLowerCase()))||s.user.username.toLowerCase().includes(n.toLowerCase())}).map(s=>{var r,h;return e.jsx("div",{onClick:()=>M(s),className:`p-4 cursor-pointer transition-all duration-200 hover:bg-gray-50 ${(l==null?void 0:l.user.id)===s.user.id?"bg-gradient-to-r from-blue-50 to-purple-50 border-l-4 border-blue-500":""}`,children:e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx("div",{className:`w-10 h-10 rounded-full flex items-center justify-center text-white font-semibold ${s.user.has_account?"bg-gradient-to-br from-blue-500 to-purple-500":"bg-gray-400"}`,children:(s.user.full_name||s.user.username||"U").charAt(0).toUpperCase()}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"text-sm font-semibold text-gray-900 truncate",children:s.user.full_name||s.user.username}),s.unread_count>0&&e.jsx("span",{className:"ml-2 bg-gradient-to-r from-blue-500 to-purple-500 text-white text-xs font-bold rounded-full px-2 py-0.5",children:s.unread_count})]}),e.jsx("p",{className:"text-sm text-gray-600 truncate mt-0.5",children:((r=s.latest_message)==null?void 0:r.content)||"No messages yet"}),e.jsxs("p",{className:"text-xs text-gray-400 mt-1 flex items-center",children:[e.jsx(ae,{className:"w-3 h-3 mr-1"}),((h=s.latest_message)==null?void 0:h.time_ago)||""]})]})]})},s.user.id)})})}),j&&e.jsxs("div",{className:"absolute inset-0 bg-white z-10 flex flex-col",children:[e.jsxs("div",{className:"p-4 border-b border-gray-200 flex items-center justify-between",children:[e.jsx("h3",{className:"font-semibold text-gray-900",children:"Select a User"}),e.jsx("button",{onClick:()=>H(!1),className:"p-1 rounded-lg hover:bg-gray-100",children:e.jsx(Y,{className:"w-5 h-5 text-gray-600"})})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-4",children:_.map((s,r)=>e.jsxs("div",{onClick:()=>es(s),className:"flex items-center space-x-3 p-3 rounded-lg hover:bg-gray-50 cursor-pointer transition-colors",children:[e.jsx("div",{className:`w-10 h-10 rounded-full flex items-center justify-center text-white font-semibold ${s.has_account?"bg-gradient-to-br from-blue-500 to-purple-500":"bg-gray-400"}`,children:(s.full_name||s.username||"U").charAt(0).toUpperCase()}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-sm font-medium text-gray-900",children:s.full_name||s.username}),e.jsxs("p",{className:"text-xs text-gray-500 flex items-center",children:[e.jsx(Me,{className:"w-3 h-3 mr-1"}),s.email]})]}),!s.has_account&&e.jsx("span",{className:"text-xs px-2 py-1 bg-gray-100 text-gray-600 rounded-full",children:"Guest"})]},s.id||`guest-${r}`))})]})]}),e.jsx("div",{className:"flex-1 flex flex-col bg-gradient-to-br from-gray-50 to-white",children:l?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"bg-white border-b border-gray-200 px-6 py-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:`w-10 h-10 rounded-full flex items-center justify-center text-white font-semibold ${l.user.has_account?"bg-gradient-to-br from-blue-500 to-purple-500":"bg-gray-400"}`,children:(l.user.full_name||l.user.username||"U").charAt(0).toUpperCase()}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:l.user.full_name||l.user.username}),!l.user.has_account&&e.jsxs("p",{className:"text-xs text-gray-500 flex items-center",children:[e.jsx(Me,{className:"w-3 h-3 mr-1"}),"Messages sent via email"]})]})]}),e.jsx("button",{className:"p-2 rounded-lg hover:bg-gray-100 transition-colors",children:e.jsx(Ns,{className:"w-5 h-5 text-gray-600"})})]})}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-6 space-y-4",children:[ye?e.jsx("div",{className:"flex items-center justify-center h-full",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-500"})}):N.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center h-full text-gray-400",children:[e.jsx(ke,{className:"w-12 h-12 mb-3"}),e.jsx("p",{className:"text-sm",children:"No messages yet. Start the conversation!"})]}):N.map(s=>e.jsx("div",{className:`flex ${s.is_from_current_user?"justify-end":"justify-start"}`,children:e.jsxs("div",{className:`group max-w-[70%] ${s.is_from_current_user?"items-end":"items-start"}`,children:[e.jsx("div",{className:`px-4 py-3 rounded-2xl shadow-sm ${s.is_from_current_user?"bg-gradient-to-r from-blue-500 to-purple-500 text-white":"bg-white text-gray-900 border border-gray-200"}`,children:e.jsx("p",{className:"text-sm leading-relaxed",children:s.content})}),e.jsxs("p",{className:`text-xs mt-1 px-2 ${s.is_from_current_user?"text-right text-gray-500":"text-left text-gray-400"}`,children:[s.time_ago,s.is_from_current_user&&s.status==="read"&&e.jsx(ne,{className:"w-3 h-3 inline ml-1 text-blue-500"})]})]})},s.id)),e.jsx("div",{ref:p})]}),e.jsx("div",{className:"bg-white border-t border-gray-200 px-6 py-4",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"flex-1 relative",children:e.jsx("input",{type:"text",value:q,onChange:s=>G(s.target.value),onKeyDown:s=>{s.key==="Enter"&&!s.shiftKey&&(s.preventDefault(),qe())},placeholder:"Type your message...",className:"w-full px-4 py-3 bg-gray-50 border border-gray-200 rounded-xl text-sm text-gray-900 placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all"})}),e.jsx("button",{onClick:qe,disabled:!q.trim(),className:`p-3 rounded-xl transition-all duration-200 ${q.trim()?"bg-gradient-to-r from-blue-500 to-purple-500 text-white shadow-lg shadow-blue-500/25 hover:shadow-xl hover:scale-105":"bg-gray-100 text-gray-400 cursor-not-allowed"}`,children:e.jsx(Pe,{className:"w-5 h-5"})})]})})]}):e.jsx("div",{className:"flex-1 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"bg-gradient-to-br from-blue-100 to-purple-100 w-24 h-24 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx($e,{className:"w-12 h-12 text-blue-600"})}),e.jsx("h3",{className:"text-xl font-semibold text-gray-900 mb-2",children:"Select a conversation"}),e.jsx("p",{className:"text-gray-600 mb-4",children:"Choose a conversation from the list or start a new one"}),e.jsx("button",{onClick:()=>H(!0),className:"px-6 py-3 bg-gradient-to-r from-blue-500 to-purple-500 text-white rounded-xl font-medium shadow-lg shadow-blue-500/25 hover:shadow-xl transition-all duration-200",children:"Start New Conversation"})]})})})]}),m==="announcements"&&e.jsx("div",{className:"flex-1 overflow-y-auto bg-gradient-to-br from-gray-50 to-white",children:e.jsxs("div",{className:"max-w-5xl mx-auto p-6",children:[e.jsxs("div",{className:"mb-6 flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Announcements"}),e.jsx("p",{className:"text-gray-600 mt-1",children:"Important updates and information"})]}),e.jsxs("button",{onClick:()=>oe(!0),className:"flex items-center space-x-2 px-4 py-2.5 bg-gradient-to-r from-blue-500 to-purple-500 text-white rounded-xl font-medium shadow-lg shadow-blue-500/25 hover:shadow-xl transition-all duration-200",children:[e.jsx(Z,{className:"w-4 h-4"}),e.jsx("span",{children:"New Announcement"})]})]}),W&&e.jsxs("div",{className:"bg-white rounded-2xl shadow-xl p-6 mb-6 border border-gray-100",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Create Announcement"}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("input",{type:"text",placeholder:"Announcement title...",value:V,onChange:s=>ce(s.target.value),className:"w-full px-4 py-3 bg-gray-50 border border-gray-200 rounded-xl text-gray-900 placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"}),e.jsx("textarea",{placeholder:"Announcement content...",value:T,onChange:s=>O(s.target.value),className:"w-full px-4 py-3 bg-gray-50 border border-gray-200 rounded-xl text-gray-900 placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent resize-none",rows:4}),e.jsxs("div",{className:"flex space-x-3",children:[e.jsxs("select",{value:i,onChange:s=>w(s.target.value),className:"flex-1 px-4 py-3 bg-gray-50 border border-gray-200 rounded-xl text-gray-900 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:"low",children:"Low Priority"}),e.jsx("option",{value:"normal",children:"Normal Priority"}),e.jsx("option",{value:"high",children:"High Priority"}),e.jsx("option",{value:"critical",children:"Critical Priority"})]}),e.jsxs("select",{value:P,onChange:s=>Q(s.target.value),className:"flex-1 px-4 py-3 bg-gray-50 border border-gray-200 rounded-xl text-gray-900 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:"general",children:"General"}),e.jsx("option",{value:"schedule",children:"Schedule Update"}),e.jsx("option",{value:"urgent",children:"Urgent"}),e.jsx("option",{value:"reminder",children:"Reminder"})]})]}),e.jsxs("div",{className:"flex space-x-3",children:[e.jsx("button",{onClick:Xe,disabled:de||!V.trim()||!T.trim(),className:"flex-1 py-3 bg-gradient-to-r from-blue-500 to-purple-500 text-white rounded-xl font-medium shadow-lg shadow-blue-500/25 hover:shadow-xl transition-all duration-200 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center space-x-2",children:de?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-5 h-5 border-2 border-white border-t-transparent rounded-full animate-spin"}),e.jsx("span",{children:"Posting & Sending Emails..."})]}):e.jsx("span",{children:"Post Announcement"})}),e.jsx("button",{onClick:()=>{oe(!1),ce(""),O(""),w("normal"),Q("general")},disabled:de,className:"flex-1 py-3 bg-gray-100 text-gray-700 rounded-xl font-medium hover:bg-gray-200 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:"Cancel"})]})]})]}),e.jsx("div",{className:"space-y-4",children:C.length===0?e.jsxs("div",{className:"bg-white rounded-2xl shadow-sm p-12 text-center",children:[e.jsx(Be,{className:"w-16 h-16 text-gray-300 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-500",children:"No announcements yet"})]}):C.map(s=>e.jsx("div",{className:`bg-white rounded-2xl shadow-sm hover:shadow-lg transition-all duration-200 overflow-hidden ${s.is_read?"":"ring-2 ring-blue-500 ring-offset-2"}`,onClick:()=>!s.is_read&&Ke(s.id),children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsxs("span",{className:`inline-flex items-center px-3 py-1 rounded-full text-xs font-medium border ${ss(s.priority)}`,children:[e.jsx("span",{className:"mr-1",children:ts(s.priority)}),s.priority.toUpperCase()]}),e.jsx("span",{className:"text-xs px-3 py-1 bg-gray-100 text-gray-600 rounded-full",children:s.announcement_type.replace("_"," ").toUpperCase()}),!s.is_read&&e.jsxs("span",{className:"flex items-center text-xs text-blue-600 font-medium",children:[e.jsx("span",{className:"w-2 h-2 bg-blue-500 rounded-full mr-1"}),"NEW"]})]}),e.jsxs("span",{className:"text-xs text-gray-500 flex items-center",children:[e.jsx(ae,{className:"w-3 h-3 mr-1"}),s.time_ago]})]}),e.jsx("h3",{className:"text-xl font-semibold text-gray-900 mb-2",children:s.title}),e.jsx("p",{className:"text-gray-700 leading-relaxed mb-3",children:s.content}),e.jsxs("div",{className:"flex items-center text-sm text-gray-500",children:[e.jsx(we,{className:"w-4 h-4 mr-1"}),e.jsx("span",{children:s.author.full_name||s.author.username})]})]})},s.id))}),!b.isLoading&&C.length>0&&e.jsxs("div",{className:"mt-8 flex flex-col items-center space-y-4",children:[e.jsxs("div",{className:"text-sm text-gray-600",children:["Showing ",C.length," of ",b.count," announcements",b.totalPages>1&&e.jsxs("span",{children:[" (Page ",b.currentPage," of ",b.totalPages,")"]})]}),b.next&&e.jsx("button",{onClick:()=>te(b.currentPage+1,!0),disabled:b.isLoadingMore,className:"px-6 py-3 bg-gradient-to-r from-blue-500 to-purple-500 text-white rounded-xl font-medium shadow-lg shadow-blue-500/25 hover:shadow-xl transition-all duration-200 disabled:opacity-50 disabled:cursor-not-allowed flex items-center space-x-2",children:b.isLoadingMore?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"}),e.jsx("span",{children:"Loading more..."})]}):e.jsxs(e.Fragment,{children:[e.jsx("span",{children:"Load More Announcements"}),e.jsx(ps,{className:"w-4 h-4"})]})}),b.totalPages>1&&e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs("button",{onClick:()=>te(b.currentPage-1),disabled:!b.previous||b.isLoading,className:"px-4 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center",children:[e.jsx(Te,{className:"w-4 h-4 mr-1 rotate-[-90deg]"}),"Previous"]}),e.jsx("div",{className:"flex items-center space-x-1",children:Array.from({length:Math.min(5,b.totalPages)},(s,r)=>{const h=r+1,v=h===b.currentPage;return e.jsx("button",{onClick:()=>te(h),disabled:b.isLoading,className:`w-10 h-10 rounded-lg font-medium transition-colors ${v?"bg-gradient-to-r from-blue-500 to-purple-500 text-white shadow-lg":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:h},h)})}),e.jsxs("button",{onClick:()=>te(b.currentPage+1),disabled:!b.next||b.isLoading,className:"px-4 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center",children:["Next",e.jsx(Te,{className:"w-4 h-4 ml-1 rotate-90"})]})]})]}),b.isLoading&&C.length===0&&e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-6 h-6 border-2 border-blue-500 border-t-transparent rounded-full animate-spin"}),e.jsx("span",{className:"text-gray-600",children:"Loading announcements..."})]})})]})}),m==="forum"&&e.jsx("div",{className:"flex-1 overflow-y-auto bg-gradient-to-br from-gray-50 to-white",children:e.jsxs("div",{className:"max-w-5xl mx-auto p-6",children:[e.jsxs("div",{className:"mb-6 flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Discussion Forum"}),e.jsx("p",{className:"text-gray-600 mt-1",children:"Join the conversation with other attendees"})]}),e.jsxs("button",{onClick:()=>U(!0),className:"flex items-center space-x-2 px-4 py-2.5 bg-gradient-to-r from-blue-500 to-purple-500 text-white rounded-xl font-medium shadow-lg shadow-blue-500/25 hover:shadow-xl transition-all duration-200",children:[e.jsx(Z,{className:"w-4 h-4"}),e.jsx("span",{children:"New Thread"})]})]}),Ce&&e.jsxs("div",{className:"bg-white rounded-2xl shadow-xl p-6 mb-6 border border-gray-100",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Start a Discussion"}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("input",{type:"text",placeholder:"Thread title...",value:F,onChange:s=>E(s.target.value),className:"w-full px-4 py-3 bg-gray-50 border border-gray-200 rounded-xl text-gray-900 placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"}),e.jsx("textarea",{placeholder:"What would you like to discuss?",value:$,onChange:s=>I(s.target.value),className:"w-full px-4 py-3 bg-gray-50 border border-gray-200 rounded-xl text-gray-900 placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent resize-none",rows:5}),e.jsxs("div",{className:"flex space-x-3",children:[e.jsx("button",{onClick:async()=>{if(!F.trim()||!$.trim()){S("Please fill in both title and content");return}je(!0);try{const s=await fetch(`${y}/api/communication/forum/threads/`,{method:"POST",headers:{Authorization:`Token ${d}`,"Content-Type":"application/json"},body:JSON.stringify({event:parseInt(u),title:F.trim(),content:$.trim(),category:"general"})});if(s.ok)U(!1),E(""),I(""),Re(),pe("Thread created successfully");else{const r=await s.json();S(`Failed to create thread: ${r.detail||"Unknown error"}`)}}catch(s){console.error("Error creating thread:",s),S("Network error: Could not create thread")}finally{je(!1)}},disabled:xe||!F.trim()||!$.trim(),className:"flex-1 py-3 bg-gradient-to-r from-blue-500 to-purple-500 text-white rounded-xl font-medium shadow-lg shadow-blue-500/25 hover:shadow-xl transition-all duration-200 disabled:opacity-50 disabled:cursor-not-allowed",children:xe?"Posting...":"Post Thread"}),e.jsx("button",{onClick:()=>{U(!1),E(""),I("")},disabled:xe,className:"flex-1 py-3 bg-gray-100 text-gray-700 rounded-xl font-medium hover:bg-gray-200 transition-colors disabled:opacity-50",children:"Cancel"})]})]})]}),e.jsx("div",{className:"space-y-4",children:z.length===0?e.jsxs("div",{className:"bg-white rounded-2xl shadow-sm p-12 text-center",children:[e.jsx(_e,{className:"w-16 h-16 text-gray-300 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-500",children:"No discussions yet. Be the first to start one!"})]}):z.map(s=>e.jsx("div",{className:"bg-white rounded-2xl shadow-sm hover:shadow-lg transition-all duration-200 p-6 cursor-pointer",children:e.jsx("div",{className:"flex items-start justify-between",children:e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[s.is_pinned&&e.jsxs("span",{className:"inline-flex items-center px-2 py-1 bg-yellow-100 text-yellow-700 text-xs font-medium rounded-full",children:[e.jsx(Ts,{className:"w-3 h-3 mr-1"}),"Pinned"]}),e.jsx("span",{className:"px-2 py-1 bg-gray-100 text-gray-600 text-xs rounded-full",children:s.category})]}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:s.title}),e.jsx("p",{className:"text-gray-600 line-clamp-2 mb-3",children:s.content}),e.jsxs("div",{className:"flex items-center text-sm text-gray-500 space-x-4",children:[e.jsxs("span",{className:"flex items-center",children:[e.jsx(we,{className:"w-4 h-4 mr-1"}),s.author.full_name||s.author.username]}),e.jsxs("span",{className:"flex items-center",children:[e.jsx(ke,{className:"w-4 h-4 mr-1"}),s.reply_count," replies"]}),e.jsxs("span",{className:"flex items-center",children:[e.jsx(ae,{className:"w-4 h-4 mr-1"}),new Date(s.created_at).toLocaleDateString()]})]})]})})},s.id))})]})}),m==="qa"&&e.jsx("div",{className:"flex-1 overflow-y-auto bg-gradient-to-br from-gray-50 to-white",children:e.jsxs("div",{className:"max-w-5xl mx-auto p-6",children:[e.jsxs("div",{className:"mb-6 flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Q&A"}),e.jsx("p",{className:"text-gray-600 mt-1",children:"Ask questions and get answers"})]}),e.jsxs("button",{onClick:()=>ie(!0),className:"flex items-center space-x-2 px-4 py-2.5 bg-gradient-to-r from-blue-500 to-purple-500 text-white rounded-xl font-medium shadow-lg shadow-blue-500/25 hover:shadow-xl transition-all duration-200",children:[e.jsx(Z,{className:"w-4 h-4"}),e.jsx("span",{children:"Ask Question"})]})]}),Se&&e.jsxs("div",{className:"bg-white rounded-2xl shadow-xl p-6 mb-6 border border-gray-100",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Ask a Question"}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("textarea",{placeholder:"What would you like to know?",value:se,onChange:s=>D(s.target.value),className:"w-full px-4 py-3 bg-gray-50 border border-gray-200 rounded-xl text-gray-900 placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent resize-none",rows:3}),e.jsxs("div",{className:"flex space-x-3",children:[e.jsx("button",{onClick:async()=>{if(!se.trim()){S("Please enter a question");return}Ne(!0);try{const s=await fetch(`${y}/api/communication/qa/questions/`,{method:"POST",headers:{Authorization:`Token ${d}`,"Content-Type":"application/json"},body:JSON.stringify({event:parseInt(u),question:se.trim()})});if(s.ok)ie(!1),D(""),ze(),pe("Question submitted successfully");else{const r=await s.json();S(`Failed to submit question: ${r.detail||"Unknown error"}`)}}catch(s){console.error("Error creating question:",s),S("Network error: Could not submit question")}finally{Ne(!1)}},disabled:me||!se.trim(),className:"flex-1 py-3 bg-gradient-to-r from-blue-500 to-purple-500 text-white rounded-xl font-medium shadow-lg shadow-blue-500/25 hover:shadow-xl transition-all duration-200 disabled:opacity-50 disabled:cursor-not-allowed",children:me?"Submitting...":"Submit Question"}),e.jsx("button",{onClick:()=>{ie(!1),D("")},disabled:me,className:"flex-1 py-3 bg-gray-100 text-gray-700 rounded-xl font-medium hover:bg-gray-200 transition-colors disabled:opacity-50",children:"Cancel"})]})]})]}),e.jsx("div",{className:"space-y-4",children:ee.length===0?e.jsxs("div",{className:"bg-white rounded-2xl shadow-sm p-12 text-center",children:[e.jsx(Oe,{className:"w-16 h-16 text-gray-300 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-500",children:"No questions yet. Ask the first one!"})]}):ee.map(s=>e.jsx("div",{className:"bg-white rounded-2xl shadow-sm hover:shadow-lg transition-all duration-200 p-6",children:e.jsxs("div",{className:"flex items-start space-x-4",children:[e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("button",{className:"p-1 rounded hover:bg-gray-100 text-gray-400 hover:text-blue-600 transition-colors",children:e.jsx(Te,{className:"w-5 h-5"})}),e.jsx("span",{className:"text-lg font-bold text-gray-700",children:s.upvotes})]}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 flex-1",children:s.question}),e.jsx("span",{className:`ml-3 px-3 py-1 rounded-full text-xs font-medium ${s.status==="answered"?"bg-green-100 text-green-700":s.status==="approved"?"bg-blue-100 text-blue-700":"bg-gray-100 text-gray-700"}`,children:s.status.toUpperCase()})]}),s.session_name&&e.jsx("span",{className:"inline-block px-2 py-1 bg-purple-100 text-purple-700 text-xs rounded-full mb-2",children:s.session_name}),e.jsxs("div",{className:"flex items-center text-sm text-gray-500 mb-3",children:[e.jsx(we,{className:"w-4 h-4 mr-1"}),e.jsx("span",{children:s.is_anonymous?"Anonymous":s.author.full_name||s.author.username}),e.jsx("span",{className:"mx-2",children:"â€¢"}),e.jsx(ae,{className:"w-4 h-4 mr-1"}),e.jsx("span",{children:new Date(s.created_at).toLocaleDateString()})]}),s.answers&&s.answers.length>0&&e.jsx("div",{className:"mt-4 space-y-3 pl-4 border-l-2 border-gray-200",children:s.answers.map(r=>e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[r.is_official&&e.jsxs("span",{className:"inline-flex items-center px-2 py-1 bg-green-100 text-green-700 text-xs font-medium rounded-full mb-2",children:[e.jsx(ne,{className:"w-3 h-3 mr-1"}),"Official Answer"]}),e.jsx("p",{className:"text-gray-700 mb-2",children:r.answer}),e.jsxs("p",{className:"text-xs text-gray-500",children:[e.jsx("span",{className:"font-medium",children:r.author.full_name||r.author.username}),e.jsx("span",{className:"mx-2",children:"â€¢"}),new Date(r.created_at).toLocaleDateString()]})]},r.id))})]})]})},s.id))})]})}),m==="icebreakers"&&e.jsx(Us,{eventId:u,token:d,showError:S,showSuccess:pe})]}),(J||ve)&&e.jsxs("div",{className:`fixed bottom-6 right-6 max-w-sm ${J?"bg-red-500":"bg-green-500"} text-white px-6 py-4 rounded-xl shadow-2xl flex items-center space-x-3 animate-slide-up`,children:[J?e.jsx(Ee,{className:"w-5 h-5 flex-shrink-0"}):e.jsx(ne,{className:"w-5 h-5 flex-shrink-0"}),e.jsx("p",{className:"text-sm font-medium",children:J||ve}),e.jsx("button",{onClick:()=>{ue(null),t(null)},className:"ml-auto text-white/80 hover:text-white",children:e.jsx(Y,{className:"w-4 h-4"})})]}),e.jsx("style",{children:`
        @keyframes slide-up {
          from {
            transform: translateY(100%);
            opacity: 0;
          }
          to {
            transform: translateY(0);
            opacity: 1;
          }
        }
        .animate-slide-up {
          animation: slide-up 0.3s ease-out;
        }
        .line-clamp-2 {
          display: -webkit-box;
          -webkit-line-clamp: 2;
          -webkit-box-orient: vertical;
          overflow: hidden;
        }
      `})]})},lt=as(function(){const{eventId:d}=rs();if(console.log("EventCommunication component loaded, eventId:",d),!d)return e.jsx("div",{className:"flex items-center justify-center h-screen",children:e.jsx("div",{className:"text-red-600 text-xl",children:"Event ID not found"})});try{return e.jsx(cs,{children:e.jsx(Os,{eventId:d})})}catch(m){return console.error("Error rendering EventCommunication:",m),e.jsx("div",{className:"flex items-center justify-center h-screen",children:e.jsxs("div",{className:"text-red-600 text-xl",children:["Error loading communication hub: ",m==null?void 0:m.toString()]})})}});export{lt as default};
