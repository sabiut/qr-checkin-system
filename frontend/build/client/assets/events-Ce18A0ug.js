import{w as y}from"./with-props-W20A4A-s.js";import{r,l as e,L as o}from"./chunk-K6CSEXPM--6-6YwCy.js";import{A as N}from"./AuthContext-ChgrtSKK.js";const M=y(function(){const{user:E,token:n,isAuthenticated:l}=r.useContext(N),[d,g]=r.useState([]),[p,c]=r.useState(!0),[h,x]=r.useState(null);return r.useEffect(()=>{(async()=>{try{if(c(!0),!n||!l)throw new Error("Authentication required");let a="https://eventqr.app";if(!a)throw console.warn("VITE_API_URL is not defined in environment variables, falling back to http://localhost:8000"),new Error("API URL configuration is missing");console.log(`Making API request to: ${a}/api/events/`);const m=await fetch(`${a}/api/events/`,{headers:{Authorization:`Token ${n}`,"Content-Type":"application/json"}});if(!m.ok)throw new Error("Failed to fetch events");const w=await m.json(),f=await Promise.all(w.map(async s=>{try{const i=await fetch(`${a}/api/attendance/?event_id=${s.id}`,{headers:{Authorization:`Token ${n}`,"Content-Type":"application/json"}}),j=(i.ok?await i.json():[]).filter(b=>b.has_attended).length,u=await fetch(`${a}/api/invitations/?event=${s.id}`,{headers:{Authorization:`Token ${n}`,"Content-Type":"application/json"}}),v=u.ok?await u.json():[];return{id:s.id,name:s.name,date:s.date,location:s.location,totalAttendees:v.length||s.attendee_count||0,checkedIn:j||0,capacity:s.max_attendees||0}}catch(i){return console.error(`Error processing event ${s.id}:`,i),{id:s.id,name:s.name,date:s.date,location:s.location,totalAttendees:s.attendee_count||0,checkedIn:0,capacity:s.max_attendees||0}}}));g(f),x(null)}catch(a){console.error("Error fetching events:",a),x("Unable to load events. Please try again later.")}finally{c(!1)}})()},[n,l]),e.jsx("div",{className:"min-h-screen bg-gray-50 py-12",children:e.jsxs("div",{className:"max-w-6xl mx-auto px-4",children:[e.jsxs("div",{className:"flex justify-between items-center mb-8",children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Your Events"}),e.jsxs(o,{to:"/events/new",className:"flex items-center justify-center gap-2 bg-blue-600 text-white px-5 py-2.5 rounded-lg hover:bg-blue-700 transition-colors shadow-sm",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M10 3a1 1 0 011 1v5h5a1 1 0 110 2h-5v5a1 1 0 11-2 0v-5H4a1 1 0 110-2h5V4a1 1 0 011-1z",clipRule:"evenodd"})}),e.jsx("span",{children:"Create New Event"})]})]}),p?e.jsx("div",{className:"flex justify-center items-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-blue-500"})}):h?e.jsx("div",{className:"bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-lg",children:h}):d.length===0?e.jsxs("div",{className:"bg-white rounded-xl shadow-md p-8 text-center",children:[e.jsx("div",{className:"w-16 h-16 bg-blue-100 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-8 w-8 text-blue-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"})})}),e.jsx("h2",{className:"text-xl font-semibold mb-2",children:"No events yet"}),e.jsx("p",{className:"text-gray-600 mb-6",children:"Create your first event to start tracking attendance"}),e.jsxs(o,{to:"/events/new",className:"inline-flex items-center justify-center gap-2 bg-blue-600 text-white px-5 py-2.5 rounded-lg hover:bg-blue-700 transition-colors shadow-sm",children:[e.jsx("span",{children:"Create Event"}),e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M10.293 5.293a1 1 0 011.414 0l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414-1.414L12.586 11H5a1 1 0 110-2h7.586l-2.293-2.293a1 1 0 010-1.414z",clipRule:"evenodd"})})]})]}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:d.map(t=>e.jsxs("div",{className:"bg-white rounded-xl shadow-md overflow-hidden hover:shadow-lg transition-shadow group",children:[e.jsx("div",{className:"bg-gradient-to-r from-blue-600 to-indigo-700 h-3 group-hover:h-4 transition-all"}),e.jsxs("div",{className:"p-6",children:[e.jsx(o,{to:`/events/${t.id}`,children:e.jsx("h2",{className:"text-xl font-bold text-gray-900 mb-2 hover:text-blue-600 transition-colors",children:t.name})}),e.jsxs("div",{className:"flex items-center text-gray-600 mb-4",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 mr-2 text-gray-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"})}),e.jsx("span",{children:new Date(t.date).toLocaleDateString()})]}),e.jsxs("div",{className:"flex items-center text-gray-600 mb-6",children:[e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 mr-2 text-gray-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:[e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"}),e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 11a3 3 0 11-6 0 3 3 0 016 0z"})]}),e.jsx("span",{children:t.location})]}),e.jsxs("div",{className:"flex flex-col space-y-4",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-gray-500 mb-1",children:"Registration"}),e.jsxs("div",{className:"flex items-center",children:[e.jsxs("span",{className:"font-semibold",children:[t.totalAttendees,"/",t.capacity]}),e.jsx("div",{className:"ml-2 h-2 w-20 bg-gray-200 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-blue-500 rounded-full",style:{width:`${Math.min(100,t.totalAttendees/t.capacity*100)}%`}})})]}),e.jsx("div",{className:"text-sm text-gray-500 mt-2 mb-1",children:"Check-in Rate"}),e.jsxs("div",{className:"flex items-center",children:[e.jsxs("span",{className:"font-semibold",children:[Math.round(t.checkedIn/t.totalAttendees*100),"%"]}),e.jsx("div",{className:"ml-2 h-2 w-20 bg-gray-200 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-green-500 rounded-full",style:{width:`${Math.min(100,t.checkedIn/t.totalAttendees*100)}%`}})})]})]}),e.jsxs("div",{className:"flex justify-between items-center pt-4 border-t border-gray-100",children:[e.jsx(o,{to:`/events/${t.id}`,className:"bg-indigo-600 text-white text-sm font-medium py-2 px-4 rounded-lg hover:bg-indigo-700 transition-colors",children:"Manage"}),e.jsx(o,{to:`/events/${t.id}/check-in`,className:"bg-blue-600 text-white text-sm font-medium py-2 px-4 rounded-lg hover:bg-blue-700 transition-colors",children:"Check-in"})]})]})]})]},t.id))})]})})});export{M as default};
